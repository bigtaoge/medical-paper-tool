<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂåªÂ≠¶ÂΩ±ÂÉèËÆ∫ÊñáÂÜô‰ΩúËæÖÂä©Â∑•ÂÖ∑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 10px;
            backdrop-filter: blur(10px);
        }
        
        .nav-tab {
            padding: 12px 24px;
            margin: 0 5px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-tab.active {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        textarea, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }
        
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .output {
            background: #ffffff;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Georgia', serif;
            line-height: 1.6;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .data-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .template-btn {
            display: inline-block;
            margin: 5px;
            padding: 8px 16px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid #667eea;
            border-radius: 6px;
            color: #667eea;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .template-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e1e5e9;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            border-radius: 3px;
        }
        
        .reference-input {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            align-items: end;
            margin-bottom: 10px;
        }

        /* Êñ∞Â¢ûÊ†∑Âºè */
        .file-upload {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .data-preview {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            background: white;
            margin: 15px 0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .data-table th, .data-table td {
            border: 1px solid #e1e5e9;
            padding: 8px;
            text-align: left;
        }

        .data-table th {
            background: #f8f9ff;
            color: #667eea;
            font-weight: 600;
        }

        .analysis-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .option-card {
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .option-card:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .option-card.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .chart-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 500;
            color: #667eea;
        }

        .data-summary {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .export-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• ÂåªÂ≠¶ÂΩ±ÂÉèËÆ∫ÊñáÂÜô‰ΩúËæÖÂä©Â∑•ÂÖ∑</h1>
            <p>‰∏ì‰∏öÁöÑÂåªÂ≠¶ÂΩ±ÂÉèÁ†îÁ©∂ËÆ∫ÊñáÂÜô‰Ωú‰∏éÊï∞ÊçÆÂàÜÊûêÂπ≥Âè∞</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('structure')">ËÆ∫ÊñáÁªìÊûÑ</button>
            <button class="nav-tab" onclick="showTab('templates')">Ê®°ÊùøÂ∫ì</button>
            <button class="nav-tab" onclick="showTab('analysis')">Êï∞ÊçÆÂàÜÊûê</button>
            <button class="nav-tab" onclick="showTab('charts')">ÂõæË°®Âà∂‰Ωú</button>
            <button class="nav-tab" onclick="showTab('references')">ÂèÇËÄÉÊñáÁåÆ</button>
        </div>
        
        <!-- ËÆ∫ÊñáÁªìÊûÑtab -->
        <div id="structure" class="tab-content active">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div style="text-align: center; margin-bottom: 20px; color: #667eea;">
                ÂÆåÊàêËøõÂ∫¶: <span id="progressText">0%</span>
            </div>
            
            <div class="section">
                <h3>üéØ Á†îÁ©∂ÁõÆÁöÑ (Objective)</h3>
                <textarea id="objective" placeholder="ÊèèËø∞Á†îÁ©∂ÁöÑËÉåÊôØ„ÄÅÊÑè‰πâÂíåÂÖ∑‰ΩìÁõÆÊ†á...

Á§∫‰æãÔºö
Êú¨Á†îÁ©∂Êó®Âú®ËØÑ‰º∞Ê∑±Â∫¶Â≠¶‰π†ÁÆóÊ≥ïÂú®ËÇ∫ÁªìËäÇÊ£ÄÊµã‰∏≠ÁöÑËØäÊñ≠ÊÄßËÉΩÔºåÊØîËæÉÂÖ∂‰∏é‰º†ÁªüCADÁ≥ªÁªüÂíåÊîæÂ∞ÑÁßëÂåªÂ∏àËØäÊñ≠ÁöÑÂáÜÁ°ÆÊÄßÔºå‰ª•ÊèêÈ´òÊó©ÊúüËÇ∫ÁôåÁ≠õÊü•ÁöÑÊïàÁéáÂíåÁ≤æÁ°ÆÂ∫¶„ÄÇ" onchange="updateProgress()"></textarea>
                <button onclick="generateObjective()">ÁîüÊàêÁõÆÁöÑÊ®°Êùø</button>
            </div>
            
            <div class="section">
                <h3>üî¨ Á†îÁ©∂ÊñπÊ≥ï (Methods)</h3>
                <textarea id="methods" placeholder="ËØ¶ÁªÜÊèèËø∞Á†îÁ©∂ËÆæËÆ°„ÄÅÂèóËØïËÄÖÈÄâÊã©„ÄÅÂΩ±ÂÉèÈááÈõÜÂèÇÊï∞„ÄÅÂàÜÊûêÊñπÊ≥ïÁ≠â...

Â∫îÂåÖÊã¨Ôºö
- Á†îÁ©∂ËÆæËÆ°Á±ªÂûã
- ÂèóËØïËÄÖÁ∫≥ÂÖ•/ÊéíÈô§Ê†áÂáÜ
- ÂΩ±ÂÉèËÆæÂ§áÂíåÂèÇÊï∞
- ÂõæÂÉèÂ§ÑÁêÜÊµÅÁ®ã
- ÁªüËÆ°ÂàÜÊûêÊñπÊ≥ï" onchange="updateProgress()"></textarea>
                <button onclick="generateMethods()">ÁîüÊàêÊñπÊ≥ïÊ®°Êùø</button>
            </div>
            
            <div class="section">
                <h3>üìä Á†îÁ©∂ÁªìÊûú (Results)</h3>
                <textarea id="results" placeholder="ÂëàÁé∞‰∏ªË¶ÅÂèëÁé∞ÔºåÂåÖÊã¨ÁªüËÆ°Êï∞ÊçÆ„ÄÅÂõæË°®ÊèèËø∞Á≠â...

Â∫îÂåÖÊã¨Ôºö
- Âü∫Á∫øÁâπÂæÅÊèèËø∞
- ‰∏ªË¶ÅÁªìÊûúÊåáÊ†á
- ÁªüËÆ°ÊòæËëóÊÄßÂàÜÊûê
- ‰∫öÁªÑÂàÜÊûêÁªìÊûú" onchange="updateProgress()"></textarea>
                <button onclick="generateResults()">ÁîüÊàêÁªìÊûúÊ®°Êùø</button>
            </div>
            
            <div class="section">
                <h3>üí° ÁªìËÆ∫ (Conclusion)</h3>
                <textarea id="conclusion" placeholder="ÊÄªÁªì‰∏ªË¶ÅÂèëÁé∞„ÄÅ‰∏¥Â∫äÊÑè‰πâÂíåÁ†îÁ©∂Â±ÄÈôêÊÄß...

Â∫îÂåÖÊã¨Ôºö
- ‰∏ªË¶ÅÂèëÁé∞ÊÄªÁªì
- ‰∏¥Â∫äÊÑè‰πâ
- Á†îÁ©∂Â±ÄÈôêÊÄß
- Êú™Êù•Á†îÁ©∂ÊñπÂêë" onchange="updateProgress()"></textarea>
                <button onclick="generateConclusion()">ÁîüÊàêÁªìËÆ∫Ê®°Êùø</button>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="exportPaper()" style="font-size: 16px; padding: 15px 30px;">üìÑ ÂØºÂá∫ÂÆåÊï¥ËÆ∫Êñá</button>
                <button onclick="saveDraft()" style="background: #28a745;">üíæ ‰øùÂ≠òËçâÁ®ø</button>
                <button onclick="loadDraft()" style="background: #ffc107; color: #000;">üìÇ Âä†ËΩΩËçâÁ®ø</button>
            </div>
            
            <div id="paperOutput" class="output" style="display: none;"></div>
        </div>
        
        <!-- Ê®°ÊùøÂ∫ìtab -->
        <div id="templates" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">üìö ËÆ∫ÊñáÊ®°ÊùøÂ∫ì</h2>
            
            <div class="section">
                <h3>ÂΩ±ÂÉèÂ≠¶Á†îÁ©∂Á±ªÂûã</h3>
                <div>
                    <span class="template-btn" onclick="loadTemplate('ct')">CTÂΩ±ÂÉèÂàÜÊûê</span>
                    <span class="template-btn" onclick="loadTemplate('mri')">MRIÁ†îÁ©∂</span>
                    <span class="template-btn" onclick="loadTemplate('ultrasound')">Ë∂ÖÂ£∞ÂΩ±ÂÉè</span>
                    <span class="template-btn" onclick="loadTemplate('xray')">XÁ∫øÁ†îÁ©∂</span>
                    <span class="template-btn" onclick="loadTemplate('pet')">PET/SPECT</span>
                    <span class="template-btn" onclick="loadTemplate('ai')">AIËæÖÂä©ËØäÊñ≠</span>
                </div>
            </div>
            
            <div class="section">
                <h3>Á†îÁ©∂ËÆæËÆ°Ê®°Êùø</h3>
                <div>
                    <span class="template-btn" onclick="loadTemplate('retrospective')">ÂõûÈ°æÊÄßÁ†îÁ©∂</span>
                    <span class="template-btn" onclick="loadTemplate('prospective')">ÂâçÁûªÊÄßÁ†îÁ©∂</span>
                    <span class="template-btn" onclick="loadTemplate('case-control')">ÁóÖ‰æãÂØπÁÖßÁ†îÁ©∂</span>
                    <span class="template-btn" onclick="loadTemplate('cohort')">ÈòüÂàóÁ†îÁ©∂</span>
                    <span class="template-btn" onclick="loadTemplate('meta')">MetaÂàÜÊûê</span>
                </div>
            </div>
            
            <div id="templateContent" class="output" style="min-height: 300px;">
                ÁÇπÂáª‰∏äÊñπÊ®°ÊùøÊåâÈíÆÂä†ËΩΩÁõ∏Â∫îÁöÑËÆ∫ÊñáÁªìÊûÑÊ®°Êùø
            </div>
        </div>
        
        <!-- Êï∞ÊçÆÂàÜÊûêtab -->
        <div id="analysis" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">üìà Êï∞ÊçÆÂàÜÊûêÂ∑•ÂÖ∑</h2>
            
            <!-- Êï∞ÊçÆÂØºÂÖ•Âå∫Âüü -->
            <div class="section">
                <h3>üìÅ Êï∞ÊçÆÂØºÂÖ•</h3>
                <div class="file-upload" onclick="document.getElementById('csvFileInput').click()">
                    <input type="file" id="csvFileInput" accept=".csv,.xlsx,.xls,.txt" onchange="importDataFile(event)">
                    <div style="color: #667eea; font-size: 18px; margin-bottom: 10px;">üìÇ</div>
                    <div>ÁÇπÂáªÈÄâÊã©Êï∞ÊçÆÊñá‰ª∂ÊàñÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§Ñ</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        ÊîØÊåÅÊ†ºÂºèÔºöCSV, Excel (.xlsx, .xls), ÊñáÊú¨Êñá‰ª∂
                    </div>
                </div>
                
                <div class="export-options">
                    <button onclick="loadSampleData()">üìã Âä†ËΩΩÁ§∫‰æãÊï∞ÊçÆ</button>
                    <button onclick="clearAllData()">üóëÔ∏è Ê∏ÖÁ©∫Êï∞ÊçÆ</button>
                    <button onclick="exportData()">üíæ ÂØºÂá∫Êï∞ÊçÆ</button>
                </div>
                
                <div id="importAlert"></div>
            </div>

            <!-- Êï∞ÊçÆÈ¢ÑËßà -->
            <div class="section" id="dataPreviewSection" style="display: none;">
                <h3>üëÄ Êï∞ÊçÆÈ¢ÑËßà</h3>
                <div class="data-summary" id="dataSummary"></div>
                <div class="data-preview" id="dataPreview"></div>
            </div>
            
            <!-- ÊâãÂä®ËæìÂÖ•Êï∞ÊçÆ -->
            <div class="section">
                <h3>‚úèÔ∏è ÊâãÂä®ËæìÂÖ•Êï∞ÊçÆ</h3>
                <div class="data-input">
                    <div>
                        <h4>ÁªÑ1Êï∞ÊçÆ (ÂÆûÈ™åÁªÑ)</h4>
                        <textarea id="group1Data" placeholder="ËæìÂÖ•Êï∞ÂÄºÔºåÁî®ÈÄóÂè∑ÂàÜÈöî
‰æãÂ¶Ç: 85.2, 87.1, 82.5, 89.3, 86.7"></textarea>
                        <input id="group1Label" placeholder="ÁªÑÂà´Ê†áÁ≠æ" value="ÂÆûÈ™åÁªÑ">
                    </div>
                    <div>
                        <h4>ÁªÑ2Êï∞ÊçÆ (ÂØπÁÖßÁªÑ)</h4>
                        <textarea id="group2Data" placeholder="ËæìÂÖ•Êï∞ÂÄºÔºåÁî®ÈÄóÂè∑ÂàÜÈöî
‰æãÂ¶Ç: 78.4, 76.8, 80.2, 75.9, 77.5"></textarea>
                        <input id="group2Label" placeholder="ÁªÑÂà´Ê†áÁ≠æ" value="ÂØπÁÖßÁªÑ">
                    </div>
                </div>
            </div>

            <!-- ÂàÜÊûêÊñπÊ≥ïÈÄâÊã© -->
            <div class="section">
                <h3>üî¨ ÂàÜÊûêÊñπÊ≥ïÈÄâÊã©</h3>
                <div class="analysis-options">
                    <div class="option-card" onclick="selectAnalysis('ttest')" id="ttest-card">
                        <h4>üìä tÊ£ÄÈ™å</h4>
                        <p>ÊØîËæÉ‰∏§ÁªÑÂùáÂÄºÂ∑ÆÂºÇ</p>
                    </div>
                    <div class="option-card" onclick="selectAnalysis('correlation')" id="correlation-card">
                        <h4>üìà Áõ∏ÂÖ≥ÊÄßÂàÜÊûê</h4>
                        <p>ÂàÜÊûêÂèòÈáèÈó¥ÂÖ≥Á≥ª</p>
                    </div>
                    <div class="option-card" onclick="selectAnalysis('anova')" id="anova-card">
                        <h4>üìã ÊñπÂ∑ÆÂàÜÊûê</h4>
                        <p>Â§öÁªÑÂùáÂÄºÊØîËæÉ</p>
                    </div>
                    <div class="option-card" onclick="selectAnalysis('regression')" id="regression-card">
                        <h4>üìâ ÂõûÂΩíÂàÜÊûê</h4>
                        <p>È¢ÑÊµãÂíåÂÖ≥Á≥ªÂª∫Ê®°</p>
                    </div>
                    <div class="option-card" onclick="selectAnalysis('nonparametric')" id="nonparametric-card">
                        <h4>üîÑ ÈùûÂèÇÊï∞Ê£ÄÈ™å</h4>
                        <p>Mann-Whitney UÊ£ÄÈ™åÁ≠â</p>
                    </div>
                    <div class="option-card" onclick="selectAnalysis('descriptive')" id="descriptive-card">
                        <h4>üìù ÊèèËø∞ÊÄßÁªüËÆ°</h4>
                        <p>Âü∫Êú¨ÁªüËÆ°ÈáèÊèèËø∞</p>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button onclick="performAnalysis()">üîç ÊâßË°åÁªüËÆ°ÂàÜÊûê</button>
                <button onclick="generateReport()">üìã ÁîüÊàêÂàÜÊûêÊä•Âëä</button>
                <button onclick="exportAnalysis()">üìÑ ÂØºÂá∫ÂàÜÊûêÁªìÊûú</button>
            </div>
            
            <div id="statsResults" class="stats-grid"></div>
            <div id="analysisReport" class="output"></div>
        </div>
        
        <!-- ÂõæË°®Âà∂‰Ωútab -->
        <div id="charts" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">üìä ÂõæË°®Âà∂‰ΩúÂ∑•ÂÖ∑</h2>
            
            <div class="section">
                <h3>üìä ÂõæË°®Á±ªÂûãÈÄâÊã©</h3>
                <div>
                    <button onclick="createChart('bar')">üìä Êü±Áä∂Âõæ</button>
                    <button onclick="createChart('line')">üìà ÊäòÁ∫øÂõæ</button>
                    <button onclick="createChart('pie')">ü•ß È•ºÂõæ</button>
                    <button onclick="createChart('scatter')">üîπ Êï£ÁÇπÂõæ</button>
                    <button onclick="createChart('roc')">üìâ ROCÊõ≤Á∫ø</button>
                    <button onclick="createChart('box')">üì¶ ÁÆ±Á∫øÂõæ</button>
                    <button onclick="createChart('histogram')">üìä Áõ¥ÊñπÂõæ</button>
                    <button onclick="createChart('heatmap')">üî• ÁÉ≠ÂäõÂõæ</button>
                </div>
            </div>
            
            <div class="section">
                <h3>‚öôÔ∏è ÂõæË°®ÈÖçÁΩÆ</h3>
                <div class="chart-controls">
                    <div class="control-group">
                        <label>ÂõæË°®Ê†áÈ¢ò:</label>
                        <input id="chartTitle" placeholder="ËæìÂÖ•ÂõæË°®Ê†áÈ¢ò" value="ËØäÊñ≠ÂáÜÁ°ÆÊÄßÊØîËæÉ">
                    </div>
                    <div class="control-group">
                        <label>XËΩ¥Ê†áÁ≠æ:</label>
                        <input id="xAxisLabel" placeholder="XËΩ¥Ê†áÁ≠æ" value="ÁªÑÂà´">
                    </div>
                    <div class="control-group">
                        <label>YËΩ¥Ê†áÁ≠æ:</label>
                        <input id="yAxisLabel" placeholder="YËΩ¥Ê†áÁ≠æ" value="ÂáÜÁ°ÆÁéá(%)">
                    </div>
                    <div class="control-group">
                        <label>ÂõæË°®È¢úËâ≤‰∏ªÈ¢ò:</label>
                        <select id="colorTheme">
                            <option value="medical">ÂåªÂ≠¶‰∏ªÈ¢ò</option>
                            <option value="professional">‰∏ì‰∏ö‰∏ªÈ¢ò</option>
                            <option value="vibrant">È≤úËâ≥‰∏ªÈ¢ò</option>
                            <option value="monochrome">ÂçïËâ≤‰∏ªÈ¢ò</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>üìù Êï∞ÊçÆËæìÂÖ•</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label>XËΩ¥Êï∞ÊçÆ/Ê†áÁ≠æ:</label>
                        <textarea id="xLabels" placeholder="Ê†áÁ≠æ1,Ê†áÁ≠æ2,Ê†áÁ≠æ3" style="height: 80px;">ÁªÑÂà´A,ÁªÑÂà´B,ÁªÑÂà´C</textarea>
                    </div>
                    <div>
                        <label>YËΩ¥Êï∞ÊçÆ/Êï∞ÂÄº:</label>
                        <textarea id="yData" placeholder="Êï∞ÂÄº1,Êï∞ÂÄº2,Êï∞ÂÄº3" style="height: 80px;">85.2,78.4,91.1</textarea>
                    </div>
                </div>
                <div style="margin-top: 10px;">
                    <button onclick="useAnalysisDataForChart()">üìä ‰ΩøÁî®ÂàÜÊûêÊï∞ÊçÆ</button>
                    <button onclick="generateRandomData()">üé≤ ÁîüÊàêÈöèÊú∫Êï∞ÊçÆ</button>
                </div>
            </div>
            
            <div id="chartContainer" class="chart-container">
                <canvas id="myChart" width="400" height="200"></canvas>
            </div>
            
            <div class="export-options">
                <button onclick="downloadChart()">üíæ ‰∏ãËΩΩÂõæË°®</button>
                <button onclick="copyChartData()">üìã Â§çÂà∂ÂõæË°®Êï∞ÊçÆ</button>
                <button onclick="saveChartTemplate()">üîñ ‰øùÂ≠ò‰∏∫Ê®°Êùø</button>
                <button onclick="exportChartCode()">üíª ÂØºÂá∫ÂõæË°®‰ª£Á†Å</button>
            </div>
        </div>
        
        <!-- ÂèÇËÄÉÊñáÁåÆtab -->
        <div id="references" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">üìö ÂèÇËÄÉÊñáÁåÆÁÆ°ÁêÜ</h2>
            
            <div class="section">
                <h3>Ê∑ªÂä†ÂèÇËÄÉÊñáÁåÆ</h3>
                <div class="reference-input">
                    <input id="refTitle" placeholder="ËÆ∫ÊñáÊ†áÈ¢ò">
                    <input id="refAuthor" placeholder="‰ΩúËÄÖ">
                    <input id="refYear" placeholder="Âπ¥‰ªΩ">
                </div>
                <div class="reference-input">
                    <input id="refJournal" placeholder="ÊúüÂàäÂêçÁß∞">
                    <input id="refVolume" placeholder="Âç∑Âè∑">
                    <input id="refPages" placeholder="È°µÁ†Å">
                </div>
                <button onclick="addReference()">‚ûï Ê∑ªÂä†ÊñáÁåÆ</button>
            </div>
            
            <div class="section">
                <h3>ÊñáÁåÆÊ†ºÂºè</h3>
                <div>
                    <button onclick="formatReferences('apa')">APAÊ†ºÂºè</button>
                    <button onclick="formatReferences('vancouver')">VancouverÊ†ºÂºè</button>
                    <button onclick="formatReferences('harvard')">HarvardÊ†ºÂºè</button>
                </div>
            </div>
            
            <div id="referencesList" class="output">
                ÂèÇËÄÉÊñáÁåÆÂ∞ÜÂú®Ê≠§ÊòæÁ§∫...
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        let currentChart = null;
        let references = [];
        let currentProgress = 0;
        let importedData = null;
        let selectedAnalysis = 'ttest';
        let analysisResults = null;
        
        // TabÂàáÊç¢ÂäüËÉΩ
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const navTabs = document.querySelectorAll('.nav-tab');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            navTabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // ËøõÂ∫¶Êõ¥Êñ∞
        function updateProgress() {
            const fields = ['objective', 'methods', 'results', 'conclusion'];
            let completed = 0;
            
            fields.forEach(field => {
                if (document.getElementById(field).value.trim().length > 50) {
                    completed++;
                }
            });
            
            currentProgress = Math.round((completed / fields.length) * 100);
            document.getElementById('progressFill').style.width = currentProgress + '%';
            document.getElementById('progressText').textContent = currentProgress + '%';
        }
        
        // ÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
        function showAlert(message, type = 'success') {
            const alertDiv = document.getElementById('importAlert');
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 5000);
        }

        // Êï∞ÊçÆÂØºÂÖ•ÂäüËÉΩ
        function importDataFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                
                try {
                    if (file.name.endsWith('.csv') || file.name.endsWith('.txt')) {
                        importedData = parseCSV(text);
                    } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        // ÁÆÄÂåñÁöÑExcelÂ§ÑÁêÜÔºåÂÆûÈôÖÂ∫îÁî®‰∏≠ÈúÄË¶Åxlsx.jsÂ∫ì
                        showAlert('ExcelÊñá‰ª∂ÂØºÂÖ•ÂäüËÉΩÈúÄË¶ÅÈ¢ùÂ§ñÁöÑÂ∫ìÊîØÊåÅÔºåËØ∑ËΩ¨Êç¢‰∏∫CSVÊ†ºÂºè', 'warning');
                        return;
                    }
                    
                    if (importedData && importedData.length > 0) {
                        showDataPreview();
                        showAlert('Êï∞ÊçÆÂØºÂÖ•ÊàêÂäüÔºÅ', 'success');
                    } else {
                        showAlert('Êñá‰ª∂Ê†ºÂºè‰∏çÊ≠£Á°ÆÊàñ‰∏∫Á©∫Êñá‰ª∂', 'error');
                    }
                } catch (error) {
                    showAlert('Êñá‰ª∂Ëß£ÊûêÂ§±Ë¥•Ôºö' + error.message, 'error');
                }
            };
            
            reader.readAsText(file);
        }

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const row = {};
                headers.forEach((header, index) => {
                    const value = values[index];
                    // Â∞ùËØïËΩ¨Êç¢‰∏∫Êï∞Â≠ó
                    row[header] = isNaN(value) ? value : parseFloat(value);
                });
                data.push(row);
            }
            
            return { headers, data };
        }

        function showDataPreview() {
            if (!importedData) return;
            
            const section = document.getElementById('dataPreviewSection');
            const summary = document.getElementById('dataSummary');
            const preview = document.getElementById('dataPreview');
            
            section.style.display = 'block';
            
            // ÊòæÁ§∫Êï∞ÊçÆÊëòË¶Å
            summary.innerHTML = `
                <strong>Êï∞ÊçÆÊëòË¶ÅÔºö</strong>
                Ë°åÊï∞: ${importedData.data.length} | 
                ÂàóÊï∞: ${importedData.headers.length} | 
                ÂàóÂêç: ${importedData.headers.join(', ')}
            `;
            
            // ÊòæÁ§∫Êï∞ÊçÆÈ¢ÑËßàË°®Ê†º
            let tableHTML = '<table class="data-table"><tr>';
            importedData.headers.forEach(header => {
                tableHTML += `<th>${header}</th>`;
            });
            tableHTML += '</tr>';
            
            // Âè™ÊòæÁ§∫Ââç10Ë°åÊï∞ÊçÆ
            const previewRows = Math.min(10, importedData.data.length);
            for (let i = 0; i < previewRows; i++) {
                tableHTML += '<tr>';
                importedData.headers.forEach(header => {
                    const value = importedData.data[i][header];
                    tableHTML += `<td>${value !== undefined ? value : ''}</td>`;
                });
                tableHTML += '</tr>';
            }
            
            if (importedData.data.length > 10) {
                tableHTML += `<tr><td colspan="${importedData.headers.length}" style="text-align: center; color: #666;">... ËøòÊúâ ${importedData.data.length - 10} Ë°åÊï∞ÊçÆ</td></tr>`;
            }
            
            tableHTML += '</table>';
            preview.innerHTML = tableHTML;
        }

        function loadSampleData() {
            const sampleCSV = `ÁªÑÂà´,ÂáÜÁ°ÆÁéá,ÊïèÊÑüÊÄß,ÁâπÂºÇÊÄß,AUC
ÂÆûÈ™åÁªÑA,85.2,82.1,88.3,0.91
ÂÆûÈ™åÁªÑB,78.4,75.8,81.0,0.85
ÂØπÁÖßÁªÑ,74.1,71.2,77.0,0.82
‰º†ÁªüÊñπÊ≥ï,69.8,66.5,73.1,0.78`;
            
            importedData = parseCSV(sampleCSV);
            showDataPreview();
            showAlert('Á§∫‰æãÊï∞ÊçÆÂ∑≤Âä†ËΩΩ', 'success');
        }

        function clearAllData() {
            importedData = null;
            document.getElementById('dataPreviewSection').style.display = 'none';
            document.getElementById('group1Data').value = '';
            document.getElementById('group2Data').value = '';
            showAlert('ÊâÄÊúâÊï∞ÊçÆÂ∑≤Ê∏ÖÁ©∫', 'success');
        }

        function exportData() {
            if (!importedData) {
                showAlert('Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÊï∞ÊçÆ', 'warning');
                return;
            }
            
            let csvContent = importedData.headers.join(',') + '\n';
            importedData.data.forEach(row => {
                const rowData = importedData.headers.map(header => row[header] || '');
                csvContent += rowData.join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Êï∞ÊçÆÂØºÂá∫_' + new Date().toLocaleDateString() + '.csv';
            a.click();
        }

        // ÂàÜÊûêÊñπÊ≥ïÈÄâÊã©
        function selectAnalysis(method) {
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById(method + '-card').classList.add('selected');
            selectedAnalysis = method;
        }

        // ÁîüÊàêÊ®°ÊùøÂáΩÊï∞
        function generateObjective() {
            const templates = [
                "Êú¨Á†îÁ©∂Êó®Âú®ËØÑ‰º∞[ÂΩ±ÂÉèÊäÄÊúØ/ÊñπÊ≥ï]Âú®[ÁñæÁóÖ/ÁóÖÂèò]ËØäÊñ≠‰∏≠ÁöÑ‰∏¥Â∫ä‰ª∑ÂÄºÔºåÊØîËæÉÂÖ∂‰∏é[ÂØπÁÖßÊñπÊ≥ï]ÁöÑËØäÊñ≠ÊÄßËÉΩÔºå‰ª•Êúü‰∏∫‰∏¥Â∫äËØäÁñóÊèê‰æõÂæ™ËØÅÂåªÂ≠¶‰æùÊçÆ„ÄÇ",
                "ÁõÆÁöÑÔºöÊé¢ËÆ®[ÂΩ±ÂÉèÂ≠¶Ë°®Áé∞/ÂæÅË±°]‰∏é[ÁñæÁóÖÈ¢ÑÂêé/Ê≤ªÁñóÊïàÊûú]ÁöÑÁõ∏ÂÖ≥ÊÄßÔºåÂª∫Á´ãÂü∫‰∫éÂΩ±ÂÉèÁâπÂæÅÁöÑ[È¢ÑÊµãÊ®°Âûã/ËØÑ‰º∞Á≥ªÁªü]„ÄÇ",
                "Êú¨Á†îÁ©∂ÈÄöËøáÂõûÈ°æÊÄßÂàÜÊûêÔºåËØÑ‰ª∑[Êñ∞ÊäÄÊúØ/Êñ∞ÊñπÊ≥ï]Âú®[ÁâπÂÆö‰∫∫Áæ§]‰∏≠ÁöÑÂ∫îÁî®‰ª∑ÂÄºÔºå‰∏∫‰ºòÂåñÂΩ±ÂÉèËØäÊñ≠ÊµÅÁ®ãÊèê‰æõÁêÜËÆ∫‰æùÊçÆ„ÄÇ"
            ];
            
            const randomTemplate = templates[Math.floor(Math.random() * templates.length)];
            document.getElementById('objective').value = randomTemplate;
            updateProgress();
        }
        
        function generateMethods() {
            const template = `Á†îÁ©∂ËÆæËÆ°ÔºöÂõûÈ°æÊÄß/ÂâçÁûªÊÄßÁ†îÁ©∂
Á†îÁ©∂ÂØπË±°ÔºöÈÄâÊã©[Êó∂Èó¥ËåÉÂõ¥]Âú®ÊàëÈô¢Â∞±ËØäÁöÑ[ÁñæÁóÖ]ÊÇ£ËÄÖ[‰æãÊï∞]‰æã
Á∫≥ÂÖ•Ê†áÂáÜÔºö(1)[Ê†áÂáÜ1]Ôºõ(2)[Ê†áÂáÜ2]Ôºõ(3)[Ê†áÂáÜ3]
ÊéíÈô§Ê†áÂáÜÔºö(1)[Ê†áÂáÜ1]Ôºõ(2)[Ê†áÂáÜ2]Ôºõ(3)[Ê†áÂáÜ3]
ÂΩ±ÂÉèÊ£ÄÊü•Ôºö‰ΩøÁî®[ËÆæÂ§áÂûãÂè∑]ËøõË°åÊ£ÄÊü•ÔºåÊâ´ÊèèÂèÇÊï∞Ôºö[ÂÖ∑‰ΩìÂèÇÊï∞]
ÂõæÂÉèÂàÜÊûêÔºöÁî±‰∏§ÂêçÂÖ∑Êúâ[Âπ¥Èôê]Âπ¥ÁªèÈ™åÁöÑÂΩ±ÂÉèÁßëÂåªÂ∏àÁã¨Á´ãÈòÖÁâá
ÁªüËÆ°ÂàÜÊûêÔºö‰ΩøÁî®SPSSËΩØ‰ª∂ËøõË°åÁªüËÆ°ÂàÜÊûêÔºåP<0.05‰∏∫Â∑ÆÂºÇÊúâÁªüËÆ°Â≠¶ÊÑè‰πâ`;
            
            document.getElementById('methods').value = template;
            updateProgress();
        }
        
        function generateResults() {
            const template = `Âü∫Á∫øÁâπÂæÅÔºöÂÖ±Á∫≥ÂÖ•ÊÇ£ËÄÖ[Êï∞Èáè]‰æãÔºåÂÖ∂‰∏≠Áî∑ÊÄß[Êï∞Èáè]‰æãÔºåÂ•≥ÊÄß[Êï∞Èáè]‰æãÔºåÂπ¥ÈæÑ[ËåÉÂõ¥]Â≤Å
‰∏ªË¶ÅÁªìÊûúÔºö
1. [ÊñπÊ≥ï1]ÁöÑÊïèÊÑüÊÄß‰∏∫[Êï∞ÂÄº]%ÔºåÁâπÂºÇÊÄß‰∏∫[Êï∞ÂÄº]%ÔºåÂáÜÁ°ÆÊÄß‰∏∫[Êï∞ÂÄº]%
2. [ÊñπÊ≥ï2]ÁöÑÊïèÊÑüÊÄß‰∏∫[Êï∞ÂÄº]%ÔºåÁâπÂºÇÊÄß‰∏∫[Êï∞ÂÄº]%ÔºåÂáÜÁ°ÆÊÄß‰∏∫[Êï∞ÂÄº]%
3. ‰∏§ÁßçÊñπÊ≥ïÁöÑËØäÊñ≠ÊÄßËÉΩÊØîËæÉÔºö[ÁªüËÆ°ÁªìÊûú]
‰∫öÁªÑÂàÜÊûêÔºö[ÂÖ∑‰ΩìÁªìÊûúÊèèËø∞]
Âπ∂ÂèëÁóáÔºö[Â¶ÇÊúâÁõ∏ÂÖ≥ÂÜÖÂÆπ]`;
            
            document.getElementById('results').value = template;
            updateProgress();
        }
        
        function generateConclusion() {
            const template = `Êú¨Á†îÁ©∂ÁªìÊûúË°®ÊòéÔºå[‰∏ªË¶ÅÂèëÁé∞]ÔºåÊèêÁ§∫[‰∏¥Â∫äÊÑè‰πâ]„ÄÇ[ÂΩ±ÂÉèÊñπÊ≥ï]Âú®[ÁñæÁóÖ]ÁöÑËØäÊñ≠‰∏≠ÂÖ∑Êúâ[‰ºòÂäø]ÔºåÂèØ‰∏∫‰∏¥Â∫äËØäÁñóÊèê‰æõÈáçË¶ÅÂèÇËÄÉ„ÄÇ

Â±ÄÈôêÊÄßÔºöÊú¨Á†îÁ©∂Â≠òÂú®‰ª•‰∏ãÂ±ÄÈôêÊÄßÔºö(1)[Â±ÄÈôêÊÄß1]Ôºõ(2)[Â±ÄÈôêÊÄß2]Ôºõ(3)[Â±ÄÈôêÊÄß3]

Êú™Êù•Á†îÁ©∂ÊñπÂêëÔºöÂª∫ËÆÆÂêéÁª≠Á†îÁ©∂ÂÖ≥Ê≥®[ÊñπÂêë1]„ÄÅ[ÊñπÂêë2]Á≠âÊñπÈù¢Ôºå‰ª•Ëøõ‰∏ÄÊ≠•‰ºòÂåñËØäÊñ≠Á≠ñÁï•„ÄÇ`;
            
            document.getElementById('conclusion').value = template;
            updateProgress();
        }
        
        // ÂØºÂá∫ËÆ∫Êñá
        function exportPaper() {
            const objective = document.getElementById('objective').value;
            const methods = document.getElementById('methods').value;
            const results = document.getElementById('results').value;
            const conclusion = document.getElementById('conclusion').value;
            
            const paper = `ÂåªÂ≠¶ÂΩ±ÂÉèÁ†îÁ©∂ËÆ∫Êñá

ÊëòË¶Å

ÁõÆÁöÑ
${objective}

ÊñπÊ≥ï
${methods}

ÁªìÊûú
${results}

ÁªìËÆ∫
${conclusion}

ÂÖ≥ÈîÆËØçÔºöÂåªÂ≠¶ÂΩ±ÂÉèÔºå[ÂÖ≥ÈîÆËØç2]Ôºå[ÂÖ≥ÈîÆËØç3]Ôºå[ÂÖ≥ÈîÆËØç4]Ôºå[ÂÖ≥ÈîÆËØç5]
`;
            
            document.getElementById('paperOutput').style.display = 'block';
            document.getElementById('paperOutput').textContent = paper;
            
            // Ëá™Âä®‰∏ãËΩΩ
            const blob = new Blob([paper], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ÂåªÂ≠¶ÂΩ±ÂÉèËÆ∫Êñá_' + new Date().toLocaleDateString() + '.txt';
            a.click();
        }
        
        // ‰øùÂ≠òÂíåÂä†ËΩΩËçâÁ®ø
        function saveDraft() {
            const draft = {
                objective: document.getElementById('objective').value,
                methods: document.getElementById('methods').value,
                results: document.getElementById('results').value,
                conclusion: document.getElementById('conclusion').value,
                timestamp: new Date().toLocaleString()
            };
            
            const draftData = JSON.stringify(draft);
            const blob = new Blob([draftData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ËÆ∫ÊñáËçâÁ®ø_' + new Date().toLocaleDateString() + '.json';
            a.click();
            
            showAlert('ËçâÁ®øÂ∑≤‰øùÂ≠òÂπ∂‰∏ãËΩΩÔºÅ');
        }
        
        function loadDraft() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const draft = JSON.parse(event.target.result);
                            document.getElementById('objective').value = draft.objective || '';
                            document.getElementById('methods').value = draft.methods || '';
                            document.getElementById('results').value = draft.results || '';
                            document.getElementById('conclusion').value = draft.conclusion || '';
                            updateProgress();
                            showAlert('ËçâÁ®øÂ∑≤ÊàêÂäüÂä†ËΩΩÔºÅ‰øùÂ≠òÊó∂Èó¥Ôºö' + draft.timestamp);
                        } catch (error) {
                            showAlert('ËçâÁ®øÊñá‰ª∂Ê†ºÂºèÈîôËØØ', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        // Ê®°ÊùøÂä†ËΩΩ
        function loadTemplate(type) {
            const templates = {
                'ct': {
                    title: 'CTÂΩ±ÂÉèÂàÜÊûêÁ†îÁ©∂Ê®°Êùø',
                    content: `ÁõÆÁöÑÔºöËØÑ‰º∞CTÂΩ±ÂÉèÂú®[ÁñæÁóÖ]ËØäÊñ≠‰∏≠ÁöÑÂ∫îÁî®‰ª∑ÂÄº

ÊñπÊ≥ïÔºö
- Á†îÁ©∂ÂØπË±°Ôºö[Êó∂Èó¥ËåÉÂõ¥]Êî∂Ê≤ªÁöÑ[ÁñæÁóÖ]ÊÇ£ËÄÖ
- CTÊâ´ÊèèÔºö‰ΩøÁî®[CTÊú∫Âûã]ÔºåÊâ´ÊèèÂèÇÊï∞ÔºöÁÆ°ÁîµÂéã[kV]ÔºåÁÆ°ÁîµÊµÅ[mAs]ÔºåÂ±ÇÂéö[mm]
- ÂõæÂÉèÈáçÂª∫ÔºöÈááÁî®[ÈáçÂª∫ÁÆóÊ≥ï]ËøõË°åÂõæÂÉèÈáçÂª∫
- ÂõæÂÉèÂàÜÊûêÔºöÊµãÈáè[ÊµãÈáèÊåáÊ†á]ÔºåËØÑ‰º∞[ËØÑ‰º∞ÂÜÖÂÆπ]

ÁªìÊûúÔºö
- CTÂæÅË±°ÊèèËø∞Ôºö[ÂÖ∑‰ΩìÂæÅË±°]
- ÂÆöÈáèÂàÜÊûêÔºö[ÊµãÈáèÁªìÊûú]
- ËØäÊñ≠ÊÄßËÉΩÔºöÊïèÊÑüÊÄß[%]ÔºåÁâπÂºÇÊÄß[%]

ÁªìËÆ∫ÔºöCTÊ£ÄÊü•Âú®[ÁñæÁóÖ]ËØäÊñ≠‰∏≠ÂÖ∑ÊúâÈáçË¶Å‰ª∑ÂÄº`
                },
                'mri': {
                    title: 'MRIÁ†îÁ©∂Ê®°Êùø',
                    content: `ÁõÆÁöÑÔºöÊé¢ËÆ®MRIÂ§öÂ∫èÂàóÊàêÂÉèÂú®[ÁñæÁóÖ]‰∏≠ÁöÑËØäÊñ≠‰ª∑ÂÄº

ÊñπÊ≥ïÔºö
- MRIËÆæÂ§áÔºö[Á£ÅÂÖ±ÊåØÊú∫Âûã] [Á£ÅÂú∫Âº∫Â∫¶]T
- Êâ´ÊèèÂ∫èÂàóÔºöT1WI„ÄÅT2WI„ÄÅDWI„ÄÅ[ÂÖ∂‰ªñÂ∫èÂàó]
- Êâ´ÊèèÂèÇÊï∞ÔºöTR/TE [ÂÖ∑‰ΩìÂèÇÊï∞]
- ÂØπÊØîÂâÇÔºö‰ΩøÁî®ÈíÜÂñ∑ÈÖ∏Ëë°ËÉ∫ÔºåÂâÇÈáè0.1mmol/kg

ÁªìÊûúÔºö
- MRI‰ø°Âè∑ÁâπÂæÅÔºöT1WI [‰ø°Âè∑]ÔºåT2WI [‰ø°Âè∑]
- DWIË°®Áé∞ÔºöADCÂÄº‰∏∫[Êï∞ÂÄº]√ó10‚Åª¬≥mm¬≤/s
- Â¢ûÂº∫ÂêéË°®Áé∞Ôºö[Â¢ûÂº∫Ê®°ÂºèÂíåÁ®ãÂ∫¶]

ÁªìËÆ∫ÔºöMRIÂ§öÂ∫èÂàóÊàêÂÉèÊúâÂä©‰∫é[ÁñæÁóÖ]ÁöÑËØäÊñ≠ÂíåÈâ¥Âà´ËØäÊñ≠`
                },
                'retrospective': {
                    title: 'ÂõûÈ°æÊÄßÁ†îÁ©∂Ê®°Êùø',
                    content: `Á†îÁ©∂ËÆæËÆ°ÔºöÂçï‰∏≠ÂøÉÂõûÈ°æÊÄßÁ†îÁ©∂

ÊñπÊ≥ïÔºö
1. Á†îÁ©∂ÂØπË±°ÔºöÂõûÈ°æÊÄßÊî∂ÈõÜ[Êó∂Èó¥ËåÉÂõ¥]Âú®ÊàëÈô¢[ÁßëÂÆ§]Â∞±ËØäÁöÑÊÇ£ËÄÖ
2. Á∫≥ÂÖ•Ê†áÂáÜÔºö(1)‰∏¥Â∫äËµÑÊñôÂÆåÊï¥Ôºõ(2)ÂΩ±ÂÉèÂ≠¶Ê£ÄÊü•ÂÆåÊï¥Ôºõ(3)ÊúâÊòéÁ°ÆËØäÊñ≠
3. ÊéíÈô§Ê†áÂáÜÔºö(1)ÂõæÂÉèË¥®ÈáèÂ∑ÆÔºõ(2)‰∏¥Â∫äËµÑÊñô‰∏çÂÖ®Ôºõ(3)ÈöèËÆøËµÑÊñôÁº∫Â§±
4. Êï∞ÊçÆÊî∂ÈõÜÔºöÊî∂ÈõÜÊÇ£ËÄÖÂü∫Êú¨‰ø°ÊÅØ„ÄÅÂÆûÈ™åÂÆ§Ê£ÄÊü•„ÄÅÂΩ±ÂÉèÂ≠¶Ë°®Áé∞Á≠â
5. ÁªüËÆ°ÊñπÊ≥ïÔºö‰ΩøÁî®SPSSËøõË°åÁªüËÆ°ÂàÜÊûê

‰º¶ÁêÜÂ≠¶ÔºöÊú¨Á†îÁ©∂Â∑≤ÈÄöËøáÂåªÈô¢‰º¶ÁêÜÂßîÂëò‰ºöÊâπÂáÜ`
                }
            };
            
            const template = templates[type];
            if (template) {
                document.getElementById('templateContent').innerHTML = `
                    <h3>${template.title}</h3>
                    <pre style="white-space: pre-wrap; font-family: inherit;">${template.content}</pre>
                    <button onclick="applyTemplate('${type}')" style="margin-top: 15px;">Â∫îÁî®Ê≠§Ê®°Êùø</button>
                `;
            }
        }
        
        function applyTemplate(type) {
            showAlert('Ê®°ÊùøÂ∑≤Â∫îÁî®ÔºÅËØ∑ÂàáÊç¢Âà∞"ËÆ∫ÊñáÁªìÊûÑ"Ê†áÁ≠æÈ°µÊü•Áúã„ÄÇ');
        }
        
        // Êï∞ÊçÆÂàÜÊûêÂäüËÉΩ
        function performAnalysis() {
            let group1, group2;
            
            // ‰ºòÂÖà‰ΩøÁî®ÂØºÂÖ•ÁöÑÊï∞ÊçÆ
            if (importedData && importedData.data.length > 0) {
                // Ëá™Âä®Ê£ÄÊµãÊï∞ÂÄºÂàó
                const numericColumns = importedData.headers.filter(header => {
                    return importedData.data.some(row => typeof row[header] === 'number');
                });
                
                if (numericColumns.length < 1) {
                    showAlert('ÂØºÂÖ•ÁöÑÊï∞ÊçÆ‰∏≠Ê≤°ÊúâÊâæÂà∞Êï∞ÂÄºÂàó', 'error');
                    return;
                }
                
                // ‰ΩøÁî®Á¨¨‰∏Ä‰∏™Êï∞ÂÄºÂàó‰Ωú‰∏∫ÂàÜÊûêÊï∞ÊçÆ
                const dataColumn = numericColumns[0];
                group1 = importedData.data.map(row => row[dataColumn]).filter(val => typeof val === 'number');
                group2 = []; // ÂØπ‰∫éÂØºÂÖ•Êï∞ÊçÆÔºåÂèØËÉΩÈúÄË¶ÅÊ†πÊçÆÂàÜÁªÑÂàóÊù•ÂàÜÂâ≤
                
                if (importedData.headers.includes('ÁªÑÂà´') || importedData.headers.includes('group')) {
                    const groupColumn = importedData.headers.includes('ÁªÑÂà´') ? 'ÁªÑÂà´' : 'group';
                    const groups = {};
                    
                    importedData.data.forEach(row => {
                        const groupName = row[groupColumn];
                        const value = row[dataColumn];
                        if (typeof value === 'number') {
                            if (!groups[groupName]) groups[groupName] = [];
                            groups[groupName].push(value);
                        }
                    });
                    
                    const groupNames = Object.keys(groups);
                    if (groupNames.length >= 2) {
                        group1 = groups[groupNames[0]];
                        group2 = groups[groupNames[1]];
                        document.getElementById('group1Label').value = groupNames[0];
                        document.getElementById('group2Label').value = groupNames[1];
                    }
                }
            } else {
                // ‰ΩøÁî®ÊâãÂä®ËæìÂÖ•ÁöÑÊï∞ÊçÆ
                group1 = document.getElementById('group1Data').value.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
                group2 = document.getElementById('group2Data').value.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
            }
            
            if (group1.length === 0) {
                showAlert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊï∞ÊçÆÊàñÂØºÂÖ•Êï∞ÊçÆÊñá‰ª∂', 'warning');
                return;
            }
            
            // Ê†πÊçÆÈÄâÊã©ÁöÑÂàÜÊûêÊñπÊ≥ïÊâßË°åÂàÜÊûê
            switch (selectedAnalysis) {
                case 'ttest':
                    performTTestAnalysis(group1, group2);
                    break;
                case 'correlation':
                    performCorrelationAnalysis(group1, group2);
                    break;
                case 'anova':
                    performAnovaAnalysis();
                    break;
                case 'regression':
                    performRegressionAnalysis(group1, group2);
                    break;
                case 'nonparametric':
                    performNonParametricAnalysis(group1, group2);
                    break;
                case 'descriptive':
                    performDescriptiveAnalysis(group1, group2);
                    break;
                default:
                    performTTestAnalysis(group1, group2);
            }
        }

        function performTTestAnalysis(group1, group2) {
            if (group2.length === 0) {
                // ÂçïÊ†∑Êú¨tÊ£ÄÈ™å
                const stats1 = calculateStats(group1);
                const tTest = performOneSampleTTest(group1, 0); // ‰∏é0ÊØîËæÉ
                displaySingleGroupStats(stats1, tTest);
            } else {
                // Áã¨Á´ãÊ†∑Êú¨tÊ£ÄÈ™å
                const stats1 = calculateStats(group1);
                const stats2 = calculateStats(group2);
                const tTest = performTTest(group1, group2);
                displayStats(stats1, stats2, tTest);
            }
        }

        function performCorrelationAnalysis(group1, group2) {
            if (group2.length === 0 || group1.length !== group2.length) {
                showAlert('Áõ∏ÂÖ≥ÊÄßÂàÜÊûêÈúÄË¶Å‰∏§ÁªÑÁ≠âÈïøÁöÑÊï∞ÊçÆ', 'warning');
                return;
            }
            
            const correlation = calculateCorrelation(group1, group2);
            displayCorrelationResults(correlation);
        }

        function performDescriptiveAnalysis(group1, group2) {
            const stats1 = calculateStats(group1);
            let stats2 = null;
            if (group2.length > 0) {
                stats2 = calculateStats(group2);
            }
            
            displayDescriptiveStats(stats1, stats2);
        }

        function performNonParametricAnalysis(group1, group2) {
            if (group2.length === 0) {
                showAlert('ÈùûÂèÇÊï∞Ê£ÄÈ™åÈúÄË¶Å‰∏§ÁªÑÊï∞ÊçÆ', 'warning');
                return;
            }
            
            const mannWhitney = performMannWhitneyTest(group1, group2);
            displayNonParametricResults(mannWhitney);
        }

        function performAnovaAnalysis() {
            if (!importedData) {
                showAlert('ANOVAÂàÜÊûêÈúÄË¶ÅÂØºÂÖ•Â§öÁªÑÊï∞ÊçÆ', 'warning');
                return;
            }
            
            showAlert('ANOVAÂàÜÊûêÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠', 'warning');
        }

        function performRegressionAnalysis(group1, group2) {
            if (group2.length === 0 || group1.length !== group2.length) {
                showAlert('ÂõûÂΩíÂàÜÊûêÈúÄË¶Å‰∏§ÁªÑÁ≠âÈïøÁöÑÊï∞ÊçÆ', 'warning');
                return;
            }
            
            const regression = calculateLinearRegression(group1, group2);
            displayRegressionResults(regression);
        }
        
        function calculateStats(data) {
            const n = data.length;
            const mean = data.reduce((a, b) => a + b, 0) / n;
            const variance = data.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / (n - 1);
            const std = Math.sqrt(variance);
            const sorted = [...data].sort((a, b) => a - b);
            const median = n % 2 === 0 ? (sorted[n/2-1] + sorted[n/2]) / 2 : sorted[Math.floor(n/2)];
            const min = Math.min(...data);
            const max = Math.max(...data);
            const q1 = sorted[Math.floor(n * 0.25)];
            const q3 = sorted[Math.floor(n * 0.75)];
            
            return { n, mean, std, median, min, max, variance, q1, q3 };
        }
        
        function performTTest(group1, group2) {
            const n1 = group1.length;
            const n2 = group2.length;
            const mean1 = group1.reduce((a, b) => a + b, 0) / n1;
            const mean2 = group2.reduce((a, b) => a + b, 0) / n2;
            
            const var1 = group1.reduce((a, b) => a + Math.pow(b - mean1, 2), 0) / (n1 - 1);
            const var2 = group2.reduce((a, b) => a + Math.pow(b - mean2, 2), 0) / (n2 - 1);
            
            const pooledVar = ((n1 - 1) * var1 + (n2 - 1) * var2) / (n1 + n2 - 2);
            const standardError = Math.sqrt(pooledVar * (1/n1 + 1/n2));
            const tStatistic = (mean1 - mean2) / standardError;
            const df = n1 + n2 - 2;
            
            // ÁÆÄÂåñÁöÑpÂÄº‰º∞ËÆ°
            const abst = Math.abs(tStatistic);
            let pValue;
            if (abst > 3.5) pValue = "< 0.001";
            else if (abst > 2.8) pValue = "< 0.01";
            else if (abst > 2.0) pValue = "< 0.05";
            else pValue = "> 0.05";
            
            return { tStatistic, df, pValue, meanDiff: mean1 - mean2, standardError };
        }

        function calculateCorrelation(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);
            
            const r = (n * sumXY - sumX * sumY) / 
                     Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            
            return { r, r2: r * r, n };
        }

        function calculateLinearRegression(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            const r = calculateCorrelation(x, y).r;
            
            return { slope, intercept, r, r2: r * r };
        }

        function performMannWhitneyTest(group1, group2) {
            // ÁÆÄÂåñÁöÑMann-Whitney UÊ£ÄÈ™å
            const combined = [...group1, ...group2];
            const ranks = combined.map((value, index) => ({ value, index, group: index < group1.length ? 1 : 2 }))
                                  .sort((a, b) => a.value - b.value)
                                  .map((item, rank) => ({ ...item, rank: rank + 1 }));
            
            const sumRank1 = ranks.filter(item => item.group === 1).reduce((sum, item) => sum + item.rank, 0);
            const u1 = sumRank1 - (group1.length * (group1.length + 1)) / 2;
            const u2 = group1.length * group2.length - u1;
            const u = Math.min(u1, u2);
            
            return { u, u1, u2, n1: group1.length, n2: group2.length };
        }
        
        function displayStats(stats1, stats2, tTest) {
            const label1 = document.getElementById('group1Label').value;
            const label2 = document.getElementById('group2Label').value;
            
            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-value">${stats1.n}</div>
                    <div class="stat-label">${label1} Ê†∑Êú¨Èáè</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.mean.toFixed(2)}</div>
                    <div class="stat-label">${label1} ÂùáÂÄº</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.std.toFixed(2)}</div>
                    <div class="stat-label">${label1} Ê†áÂáÜÂ∑Æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats2.n}</div>
                    <div class="stat-label">${label2} Ê†∑Êú¨Èáè</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats2.mean.toFixed(2)}</div>
                    <div class="stat-label">${label2} ÂùáÂÄº</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats2.std.toFixed(2)}</div>
                    <div class="stat-label">${label2} Ê†áÂáÜÂ∑Æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${tTest.tStatistic.toFixed(3)}</div>
                    <div class="stat-label">tÁªüËÆ°Èáè</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${tTest.pValue}</div>
                    <div class="stat-label">PÂÄº</div>
                </div>
            `;
            
            document.getElementById('statsResults').innerHTML = statsHtml;
            analysisResults = { stats1, stats2, tTest, type: 'ttest' };
        }

        function displayDescriptiveStats(stats1, stats2) {
            const label1 = document.getElementById('group1Label').value || 'Êï∞ÊçÆÁªÑ';
            let statsHtml = `
                <div class="stat-card">
                    <div class="stat-value">${stats1.n}</div>
                    <div class="stat-label">${label1} Ê†∑Êú¨Èáè</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.mean.toFixed(2)}</div>
                    <div class="stat-label">${label1} ÂùáÂÄº</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.median.toFixed(2)}</div>
                    <div class="stat-label">${label1} ‰∏≠‰ΩçÊï∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.std.toFixed(2)}</div>
                    <div class="stat-label">${label1} Ê†áÂáÜÂ∑Æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.min.toFixed(2)}</div>
                    <div class="stat-label">${label1} ÊúÄÂ∞èÂÄº</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.max.toFixed(2)}</div>
                    <div class="stat-label">${label1} ÊúÄÂ§ßÂÄº</div>
                </div>
            `;

            if (stats2) {
                const label2 = document.getElementById('group2Label').value || 'ÂØπÁÖßÁªÑ';
                statsHtml += `
                    <div class="stat-card">
                        <div class="stat-value">${stats2.mean.toFixed(2)}</div>
                        <div class="stat-label">${label2} ÂùáÂÄº</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats2.std.toFixed(2)}</div>
                        <div class="stat-label">${label2} Ê†áÂáÜÂ∑Æ</div>
                    </div>
                `;
            }
            
            document.getElementById('statsResults').innerHTML = statsHtml;
            analysisResults = { stats1, stats2, type: 'descriptive' };
        }
        
        function generateReport() {
            if (!analysisResults) {
                showAlert('ËØ∑ÂÖàÊâßË°åÁªüËÆ°ÂàÜÊûê', 'warning');
                return;
            }

            let report = '';
            
            switch (analysisResults.type) {
                case 'ttest':
                    report = generateTTestReport();
                    break;
                case 'descriptive':
                    report = generateDescriptiveReport();
                    break;
                case 'correlation':
                    report = generateCorrelationReport();
                    break;
                default:
                    report = 'ÂàÜÊûêÊä•ÂëäÁîüÊàê‰∏≠...';
            }
            
            document.getElementById('analysisReport').textContent = report;
        }

        function generateTTestReport() {
            const { stats1, stats2, tTest } = analysisResults;
            const label1 = document.getElementById('group1Label').value;
            const label2 = document.getElementById('group2Label').value;
            
            return `ÁªüËÆ°ÂàÜÊûêÊä•Âëä - Áã¨Á´ãÊ†∑Êú¨tÊ£ÄÈ™å

Âü∫Êú¨ÊèèËø∞ÊÄßÁªüËÆ°Ôºö
${label1}ÁªÑÔºöÊ†∑Êú¨Èáè ${stats1.n} ‰æãÔºåÂπ≥ÂùáÂÄº ${stats1.mean.toFixed(2)} ¬± ${stats1.std.toFixed(2)}Ôºå
‰∏≠‰ΩçÊï∞ ${stats1.median.toFixed(2)}ÔºåËåÉÂõ¥ ${stats1.min.toFixed(2)} - ${stats1.max.toFixed(2)}

${label2}ÁªÑÔºöÊ†∑Êú¨Èáè ${stats2.n} ‰æãÔºåÂπ≥ÂùáÂÄº ${stats2.mean.toFixed(2)} ¬± ${stats2.std.toFixed(2)}Ôºå
‰∏≠‰ΩçÊï∞ ${stats2.median.toFixed(2)}ÔºåËåÉÂõ¥ ${stats2.min.toFixed(2)} - ${stats2.max.toFixed(2)}

ÁªÑÈó¥ÊØîËæÉÔºö
ÈááÁî®Áã¨Á´ãÊ†∑Êú¨tÊ£ÄÈ™åÊØîËæÉ‰∏§ÁªÑÈó¥Â∑ÆÂºÇ„ÄÇ
t = ${tTest.tStatistic.toFixed(3)}, df = ${tTest.df}, P ${tTest.pValue}
ÂùáÂÄºÂ∑ÆÂÄºÔºö${tTest.meanDiff.toFixed(2)}
Ê†áÂáÜËØØÔºö${tTest.standardError.toFixed(3)}

ÁªìËÆ∫Ôºö
${tTest.pValue.includes('<') ? '‰∏§ÁªÑÈó¥Â∑ÆÂºÇÂÖ∑ÊúâÁªüËÆ°Â≠¶ÊÑè‰πâ' : '‰∏§ÁªÑÈó¥Â∑ÆÂºÇÊó†ÁªüËÆ°Â≠¶ÊÑè‰πâ'}ÔºàP ${tTest.pValue}Ôºâ„ÄÇ

Ê≥®ÔºöÊú¨ÂàÜÊûêÂü∫‰∫éÊ≠£ÊÄÅÂàÜÂ∏ÉÂÅáËÆæÔºåÂª∫ËÆÆÊ†πÊçÆÂÆûÈôÖÊï∞ÊçÆÂàÜÂ∏ÉÈÄâÊã©ÂêàÈÄÇÁöÑÁªüËÆ°ÊñπÊ≥ï„ÄÇ`;
        }

        function generateDescriptiveReport() {
            const { stats1, stats2 } = analysisResults;
            const label1 = document.getElementById('group1Label').value || 'Êï∞ÊçÆÁªÑ';
            
            let report = `ÊèèËø∞ÊÄßÁªüËÆ°ÂàÜÊûêÊä•Âëä

${label1}Êï∞ÊçÆÊèèËø∞Ôºö
- Ê†∑Êú¨ÈáèÔºö${stats1.n} ‰æã
- Âπ≥ÂùáÂÄºÔºö${stats1.mean.toFixed(2)} ¬± ${stats1.std.toFixed(2)}
- ‰∏≠‰ΩçÊï∞Ôºö${stats1.median.toFixed(2)}
- ÂõõÂàÜ‰ΩçÊï∞ÔºöQ1 = ${stats1.q1.toFixed(2)}, Q3 = ${stats1.q3.toFixed(2)}
- ËåÉÂõ¥Ôºö${stats1.min.toFixed(2)} - ${stats1.max.toFixed(2)}
- ÊñπÂ∑ÆÔºö${stats1.variance.toFixed(2)}`;

            if (stats2) {
                const label2 = document.getElementById('group2Label').value || 'ÂØπÁÖßÁªÑ';
                report += `

${label2}Êï∞ÊçÆÊèèËø∞Ôºö
- Ê†∑Êú¨ÈáèÔºö${stats2.n} ‰æã
- Âπ≥ÂùáÂÄºÔºö${stats2.mean.toFixed(2)} ¬± ${stats2.std.toFixed(2)}
- ‰∏≠‰ΩçÊï∞Ôºö${stats2.median.toFixed(2)}
- ÂõõÂàÜ‰ΩçÊï∞ÔºöQ1 = ${stats2.q1.toFixed(2)}, Q3 = ${stats2.q3.toFixed(2)}
- ËåÉÂõ¥Ôºö${stats2.min.toFixed(2)} - ${stats2.max.toFixed(2)}`;
            }

            return report;
        }

        function exportAnalysis() {
            if (!analysisResults) {
                showAlert('Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÂàÜÊûêÁªìÊûú', 'warning');
                return;
            }
            
            const report = document.getElementById('analysisReport').textContent;
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ÁªüËÆ°ÂàÜÊûêÊä•Âëä_' + new Date().toLocaleDateString() + '.txt';
            a.click();
        }
        
        // ÂõæË°®Âà∂‰ΩúÂäüËÉΩ
        function getColorTheme(theme) {
            const themes = {
                medical: [
                    'rgba(102, 126, 234, 0.8)',
                    'rgba(118, 75, 162, 0.8)',
                    'rgba(67, 163, 255, 0.8)',
                    'rgba(139, 195, 74, 0.8)',
                    'rgba(255, 193, 7, 0.8)',
                    'rgba(255, 87, 34, 0.8)'
                ],
                professional: [
                    'rgba(54, 162, 235, 0.8)',
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(255, 205, 86, 0.8)',
                    'rgba(75, 192, 192, 0.8)',
                    'rgba(153, 102, 255, 0.8)',
                    'rgba(255, 159, 64, 0.8)'
                ],
                vibrant: [
                    'rgba(255, 0, 128, 0.8)',
                    'rgba(0, 255, 128, 0.8)',
                    'rgba(128, 0, 255, 0.8)',
                    'rgba(255, 128, 0, 0.8)',
                    'rgba(0, 128, 255, 0.8)',
                    'rgba(128, 255, 0, 0.8)'
                ],
                monochrome: [
                    'rgba(52, 58, 64, 0.8)',
                    'rgba(108, 117, 125, 0.8)',
                    'rgba(173, 181, 189, 0.8)',
                    'rgba(222, 226, 230, 0.8)',
                    'rgba(248, 249, 250, 0.8)'
                ]
            };
            return themes[theme] || themes.medical;
        }

        function createChart(type) {
            const xLabels = document.getElementById('xLabels').value.split(',').map(x => x.trim());
            const yData = document.getElementById('yData').value.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
            const title = document.getElementById('chartTitle').value;
            const xAxisLabel = document.getElementById('xAxisLabel').value;
            const yAxisLabel = document.getElementById('yAxisLabel').value;
            const colorTheme = document.getElementById('colorTheme').value;
            
            if (currentChart) {
                currentChart.destroy();
            }
            
            const ctx = document.getElementById('myChart').getContext('2d');
            const colors = getColorTheme(colorTheme);
            
            let config = {
                type: type,
                data: {
                    labels: xLabels,
                    datasets: [{
                        label: yAxisLabel || 'Êï∞ÂÄº',
                        data: yData,
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace('0.8', '1')),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: title,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: type !== 'pie'
                        }
                    },
                    scales: type === 'pie' ? {} : {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: yAxisLabel
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: xAxisLabel
                            }
                        }
                    }
                }
            };
            
            // ÁâπÊÆäÂõæË°®Á±ªÂûãÂ§ÑÁêÜ
            if (type === 'roc') {
                config = createROCChart(colors[0]);
            } else if (type === 'box') {
                config = createBoxPlot(colors[0]);
            } else if (type === 'histogram') {
                config = createHistogram(yData, colors[0]);
            } else if (type === 'heatmap') {
                showAlert('ÁÉ≠ÂäõÂõæÂäüËÉΩÈúÄË¶ÅÈ¢ùÂ§ñÁöÑÊèí‰ª∂ÊîØÊåÅ', 'warning');
                return;
            }
            
            currentChart = new Chart(ctx, config);
        }

        function createROCChart(color) {
            return {
                type: 'line',
                data: {
                    labels: ['0.0', '0.1', '0.2', '0.3', '0.4', '0.5', '0.6', '0.7', '0.8', '0.9', '1.0'],
                    datasets: [{
                        label: 'ROCÊõ≤Á∫ø (AUC=0.85)',
                        data: [0, 0.15, 0.35, 0.52, 0.68, 0.78, 0.85, 0.91, 0.95, 0.98, 1.0],
                        borderColor: color.replace('0.8', '1'),
                        backgroundColor: color.replace('0.8', '0.1'),
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'ÂèÇËÄÉÁ∫ø',
                        data: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0],
                        borderColor: 'rgba(128, 128, 128, 0.5)',
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ROCÊõ≤Á∫øÂàÜÊûê',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: '1-ÁâπÂºÇÊÄß' },
                            min: 0,
                            max: 1
                        },
                        y: {
                            title: { display: true, text: 'ÊïèÊÑüÊÄß' },
                            min: 0,
                            max: 1
                        }
                    }
                }
            };
        }

        function createBoxPlot(color) {
            // ÁÆÄÂåñÁöÑÁÆ±Á∫øÂõæÔºå‰ΩøÁî®ÊäòÁ∫øÂõæÊ®°Êãü
            const data = document.getElementById('yData').value.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
            if (data.length === 0) return;
            
            const sorted = [...data].sort((a, b) => a - b);
            const q1 = sorted[Math.floor(sorted.length * 0.25)];
            const median = sorted[Math.floor(sorted.length * 0.5)];
            const q3 = sorted[Math.floor(sorted.length * 0.75)];
            const min = Math.min(...data);
            const max = Math.max(...data);
            
            return {
                type: 'bar',
                data: {
                    labels: ['ÊúÄÂ∞èÂÄº', 'Q1', '‰∏≠‰ΩçÊï∞', 'Q3', 'ÊúÄÂ§ßÂÄº'],
                    datasets: [{
                        label: 'Êï∞ÊçÆÂàÜÂ∏É',
                        data: [min, q1, median, q3, max],
                        backgroundColor: color,
                        borderColor: color.replace('0.8', '1'),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Êï∞ÊçÆÂàÜÂ∏ÉÂõæÔºà‰∫îÊï∞Ê¶ÇÊã¨Ôºâ',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: { display: true, text: 'Êï∞ÂÄº' }
                        }
                    }
                }
            };
        }

        function createHistogram(data, color) {
            if (data.length === 0) return;
            
            // ÁÆÄÂçïÁöÑÁõ¥ÊñπÂõæÂàÜÁªÑ
            const min = Math.min(...data);
            const max = Math.max(...data);
            const bins = 8;
            const binWidth = (max - min) / bins;
            const binCounts = new Array(bins).fill(0);
            const binLabels = [];
            
            for (let i = 0; i < bins; i++) {
                const start = min + i * binWidth;
                const end = start + binWidth;
                binLabels.push(`${start.toFixed(1)}-${end.toFixed(1)}`);
                
                data.forEach(value => {
                    if (value >= start && (value < end || i === bins - 1)) {
                        binCounts[i]++;
                    }
                });
            }
            
            return {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'È¢ëÊï∞',
                        data: binCounts,
                        backgroundColor: color,
                        borderColor: color.replace('0.8', '1'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Êï∞ÊçÆÂàÜÂ∏ÉÁõ¥ÊñπÂõæ',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'È¢ëÊï∞' }
                        },
                        x: {
                            title: { display: true, text: 'Êï∞ÂÄºÂå∫Èó¥' }
                        }
                    }
                }
            };
        }

        function useAnalysisDataForChart() {
            if (!analysisResults) {
                showAlert('ËØ∑ÂÖàÊâßË°åÊï∞ÊçÆÂàÜÊûê', 'warning');
                return;
            }
            
            const { stats1, stats2 } = analysisResults;
            const label1 = document.getElementById('group1Label').value || 'ÁªÑ1';
            const label2 = document.getElementById('group2Label').value || 'ÁªÑ2';
            
            if (stats2) {
                document.getElementById('xLabels').value = `${label1},${label2}`;
                document.getElementById('yData').value = `${stats1.mean.toFixed(2)},${stats2.mean.toFixed(2)}`;
            } else {
                document.getElementById('xLabels').value = label1;
                document.getElementById('yData').value = stats1.mean.toFixed(2);
            }
            
            showAlert('ÂàÜÊûêÊï∞ÊçÆÂ∑≤Â∫îÁî®Âà∞ÂõæË°®', 'success');
        }

        function generateRandomData() {
            const count = 5;
            const labels = [];
            const values = [];
            
            for (let i = 1; i <= count; i++) {
                labels.push(`ÁªÑÂà´${i}`);
                values.push((Math.random() * 50 + 50).toFixed(1));
            }
            
            document.getElementById('xLabels').value = labels.join(',');
            document.getElementById('yData').value = values.join(',');
            showAlert('ÈöèÊú∫Êï∞ÊçÆÂ∑≤ÁîüÊàê', 'success');
        }
        
        function downloadChart() {
            if (!currentChart) {
                showAlert('ËØ∑ÂÖàÂàõÂª∫ÂõæË°®', 'warning');
                return;
            }
            
            const url = currentChart.toBase64Image();
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ÂõæË°®_' + new Date().toLocaleDateString() + '.png';
            a.click();
        }
        
        function copyChartData() {
            const xLabels = document.getElementById('xLabels').value;
            const yData = document.getElementById('yData').value;
            const title = document.getElementById('chartTitle').value;
            
            const chartData = `ÂõæË°®Ê†áÈ¢ò: ${title}
XËΩ¥Ê†áÁ≠æ: ${xLabels}
YËΩ¥Êï∞ÊçÆ: ${yData}`;
            
            navigator.clipboard.writeText(chartData).then(() => {
                showAlert('ÂõæË°®Êï∞ÊçÆÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
            });
        }

        function saveChartTemplate() {
            const template = {
                title: document.getElementById('chartTitle').value,
                xAxis: document.getElementById('xAxisLabel').value,
                yAxis: document.getElementById('yAxisLabel').value,
                xLabels: document.getElementById('xLabels').value,
                yData: document.getElementById('yData').value,
                colorTheme: document.getElementById('colorTheme').value,
                timestamp: new Date().toLocaleString()
            };
            
            const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ÂõæË°®Ê®°Êùø_' + new Date().toLocaleDateString() + '.json';
            a.click();
            
            showAlert('ÂõæË°®Ê®°ÊùøÂ∑≤‰øùÂ≠ò');
        }

        function exportChartCode() {
            if (!currentChart) {
                showAlert('ËØ∑ÂÖàÂàõÂª∫ÂõæË°®', 'warning');
                return;
            }
            
            const code = `// Chart.js ÂõæË°®‰ª£Á†Å
const ctx = document.getElementById('myChart').getContext('2d');
const chart = new Chart(ctx, ${JSON.stringify(currentChart.config, null, 2)});`;
            
            const blob = new Blob([code], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ÂõæË°®‰ª£Á†Å_' + new Date().toLocaleDateString() + '.js';
            a.click();
        }
        
        // ÂèÇËÄÉÊñáÁåÆÁÆ°ÁêÜ
        function addReference() {
            const title = document.getElementById('refTitle').value;
            const author = document.getElementById('refAuthor').value;
            const year = document.getElementById('refYear').value;
            const journal = document.getElementById('refJournal').value;
            const volume = document.getElementById('refVolume').value;
            const pages = document.getElementById('refPages').value;
            
            if (!title || !author || !year) {
                showAlert('ËØ∑Ëá≥Â∞ëÂ°´ÂÜôÊ†áÈ¢ò„ÄÅ‰ΩúËÄÖÂíåÂπ¥‰ªΩ', 'warning');
                return;
            }
            
            const reference = {
                id: references.length + 1,
                title,
                author,
                year,
                journal,
                volume,
                pages
            };
            
            references.push(reference);
            
            // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
            document.getElementById('refTitle').value = '';
            document.getElementById('refAuthor').value = '';
            document.getElementById('refYear').value = '';
            document.getElementById('refJournal').value = '';
            document.getElementById('refVolume').value = '';
            document.getElementById('refPages').value = '';
            
            formatReferences('vancouver'); // ÈªòËÆ§ÊòæÁ§∫VancouverÊ†ºÂºè
            showAlert('ÂèÇËÄÉÊñáÁåÆÂ∑≤Ê∑ªÂä†', 'success');
        }
        
        function formatReferences(style) {
            if (references.length === 0) {
                document.getElementById('referencesList').innerHTML = 'ÊöÇÊó†ÂèÇËÄÉÊñáÁåÆÔºåËØ∑ÂÖàÊ∑ªÂä†ÊñáÁåÆ';
                return;
            }
            
            let formattedRefs = '';
            
            references.forEach((ref, index) => {
                let formatted = '';
                
                switch (style) {
                    case 'apa':
                        formatted = `${ref.author} (${ref.year}). ${ref.title}. ${ref.journal || 'ÊúüÂàäÂêç'}${ref.volume ? `, ${ref.volume}` : ''}${ref.pages ? `, ${ref.pages}` : ''}.`;
                        break;
                    case 'vancouver':
                        formatted = `${index + 1}. ${ref.author}. ${ref.title}. ${ref.journal || 'ÊúüÂàäÂêç'}. ${ref.year}${ref.volume ? `;${ref.volume}` : ''}${ref.pages ? `:${ref.pages}` : ''}.`;
                        break;
                    case 'harvard':
                        formatted = `${ref.author}, ${ref.year}. '${ref.title}', ${ref.journal || 'ÊúüÂàäÂêç'}${ref.volume ? `, vol. ${ref.volume}` : ''}${ref.pages ? `, pp. ${ref.pages}` : ''}.`;
                        break;
                }
                
                formattedRefs += formatted + '\n\n';
            });
            
            document.getElementById('referencesList').innerHTML = `<strong>${style.toUpperCase()}Ê†ºÂºèÔºö</strong><br><br><pre style="white-space: pre-wrap; font-family: inherit;">${formattedRefs}</pre>`;
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        window.onload = function() {
            updateProgress();
            // ÂàùÂßãÂåñÂõæË°®
            createChart('bar');
            // ÈªòËÆ§ÈÄâÊã©tÊ£ÄÈ™å
            selectAnalysis('ttest');
        };
    </script>
</body>
</html>
