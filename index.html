<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ»å­¦å½±åƒè®ºæ–‡å†™ä½œè¾…åŠ©å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 10px;
            backdrop-filter: blur(10px);
        }
        
        .nav-tab {
            padding: 12px 24px;
            margin: 0 5px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-tab.active {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        textarea, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }
        
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .output {
            background: #ffffff;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Georgia', serif;
            line-height: 1.6;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .data-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .template-btn {
            display: inline-block;
            margin: 5px;
            padding: 8px 16px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid #667eea;
            border-radius: 6px;
            color: #667eea;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .template-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e1e5e9;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            border-radius: 3px;
        }
        
        .reference-input {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            align-items: end;
            margin-bottom: 10px;
        }

        /* æ–°å¢æ ·å¼ */
        .file-upload {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .data-preview {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            background: white;
            margin: 15px 0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .data-table th, .data-table td {
            border: 1px solid #e1e5e9;
            padding: 8px;
            text-align: left;
        }

        .data-table th {
            background: #f8f9ff;
            color: #667eea;
            font-weight: 600;
        }

        .analysis-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .option-card {
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .option-card:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .option-card.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .chart-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 500;
            color: #667eea;
        }

        .data-summary {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .export-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ åŒ»å­¦å½±åƒè®ºæ–‡å†™ä½œè¾…åŠ©å·¥å…·</h1>
            <p>ä¸“ä¸šçš„åŒ»å­¦å½±åƒç ”ç©¶è®ºæ–‡å†™ä½œä¸æ•°æ®åˆ†æå¹³å°</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('structure')">è®ºæ–‡ç»“æ„</button>
            <button class="nav-tab" onclick="showTab('templates')">æ¨¡æ¿åº“</button>
            <button class="nav-tab" onclick="showTab('analysis')">æ•°æ®åˆ†æ</button>
            <button class="nav-tab" onclick="showTab('charts')">å›¾è¡¨åˆ¶ä½œ</button>
            <button class="nav-tab" onclick="showTab('references')">å‚è€ƒæ–‡çŒ®</button>
        </div>
        
        <!-- è®ºæ–‡ç»“æ„tab -->
        <div id="structure" class="tab-content active">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div style="text-align: center; margin-bottom: 20px; color: #667eea;">
                å®Œæˆè¿›åº¦: <span id="progressText">0%</span>
            </div>
            
            <div class="section">
                <h3>ğŸ¯ ç ”ç©¶ç›®çš„ (Objective)</h3>
                <textarea id="objective" placeholder="æè¿°ç ”ç©¶çš„èƒŒæ™¯ã€æ„ä¹‰å’Œå…·ä½“ç›®æ ‡...

ç¤ºä¾‹ï¼š
æœ¬ç ”ç©¶æ—¨åœ¨è¯„ä¼°æ·±åº¦å­¦ä¹ ç®—æ³•åœ¨è‚ºç»“èŠ‚æ£€æµ‹ä¸­çš„è¯Šæ–­æ€§èƒ½ï¼Œæ¯”è¾ƒå…¶ä¸ä¼ ç»ŸCADç³»ç»Ÿå’Œæ”¾å°„ç§‘åŒ»å¸ˆè¯Šæ–­çš„å‡†ç¡®æ€§ï¼Œä»¥æé«˜æ—©æœŸè‚ºç™Œç­›æŸ¥çš„æ•ˆç‡å’Œç²¾ç¡®åº¦ã€‚" onchange="updateProgress()"></textarea>
                <button onclick="generateObjective()">ç”Ÿæˆç›®çš„æ¨¡æ¿</button>
            </div>
            
            <div class="section">
                <h3>ğŸ”¬ ç ”ç©¶æ–¹æ³• (Methods)</h3>
                <textarea id="methods" placeholder="è¯¦ç»†æè¿°ç ”ç©¶è®¾è®¡ã€å—è¯•è€…é€‰æ‹©ã€å½±åƒé‡‡é›†å‚æ•°ã€åˆ†ææ–¹æ³•ç­‰...

åº”åŒ…æ‹¬ï¼š
- ç ”ç©¶è®¾è®¡ç±»å‹
- å—è¯•è€…çº³å…¥/æ’é™¤æ ‡å‡†
- å½±åƒè®¾å¤‡å’Œå‚æ•°
- å›¾åƒå¤„ç†æµç¨‹
- ç»Ÿè®¡åˆ†ææ–¹æ³•" onchange="updateProgress()"></textarea>
                <button onclick="generateMethods()">ç”Ÿæˆæ–¹æ³•æ¨¡æ¿</button>
            </div>
            
            <div class="section">
                <h3>ğŸ“Š ç ”ç©¶ç»“æœ (Results)</h3>
                <textarea id="results" placeholder="å‘ˆç°ä¸»è¦å‘ç°ï¼ŒåŒ…æ‹¬ç»Ÿè®¡æ•°æ®ã€å›¾è¡¨æè¿°ç­‰...

åº”åŒ…æ‹¬ï¼š
- åŸºçº¿ç‰¹å¾æè¿°
- ä¸»è¦ç»“æœæŒ‡æ ‡
- ç»Ÿè®¡æ˜¾è‘—æ€§åˆ†æ
- äºšç»„åˆ†æç»“æœ" onchange="updateProgress()"></textarea>
                <button onclick="generateResults()">ç”Ÿæˆç»“æœæ¨¡æ¿</button>
            </div>
            
            <div class="section">
                <h3>ğŸ’¡ ç»“è®º (Conclusion)</h3>
                <textarea id="conclusion" placeholder="æ€»ç»“ä¸»è¦å‘ç°ã€ä¸´åºŠæ„ä¹‰å’Œç ”ç©¶å±€é™æ€§...

åº”åŒ…æ‹¬ï¼š
- ä¸»è¦å‘ç°æ€»ç»“
- ä¸´åºŠæ„ä¹‰
- ç ”ç©¶å±€é™æ€§
- æœªæ¥ç ”ç©¶æ–¹å‘" onchange="updateProgress()"></textarea>
                <button onclick="generateConclusion()">ç”Ÿæˆç»“è®ºæ¨¡æ¿</button>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="exportPaper()" style="font-size: 16px; padding: 15px 30px;">ğŸ“„ å¯¼å‡ºå®Œæ•´è®ºæ–‡</button>
                <button onclick="saveDraft()" style="background: #28a745;">ğŸ’¾ ä¿å­˜è‰ç¨¿</button>
                <button onclick="loadDraft()" style="background: #ffc107; color: #000;">ğŸ“‚ åŠ è½½è‰ç¨¿</button>
            </div>
            
            <div id="paperOutput" class="output" style="display: none;"></div>
        </div>
        
        <!-- æ¨¡æ¿åº“tab -->
        <div id="templates" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“š è®ºæ–‡æ¨¡æ¿åº“</h2>
            
            <div class="section">
                <h3>å½±åƒå­¦ç ”ç©¶ç±»å‹</h3>
                <div>
                    <span class="template-btn" onclick="loadTemplate('ct')">CTå½±åƒåˆ†æ</span>
                    <span class="template-btn" onclick="loadTemplate('mri')">MRIç ”ç©¶</span>
                    <span class="template-btn" onclick="loadTemplate('ultrasound')">è¶…å£°å½±åƒ</span>
                    <span class="template-btn" onclick="loadTemplate('xray')">Xçº¿ç ”ç©¶</span>
                    <span class="template-btn" onclick="loadTemplate('pet')">PET/SPECT</span>
                    <span class="template-btn" onclick="loadTemplate('ai')">AIè¾…åŠ©è¯Šæ–­</span>
                </div>
            </div>
            
            <div class="section">
                <h3>ç ”ç©¶è®¾è®¡æ¨¡æ¿</h3>
                <div>
                    <span class="template-btn" onclick="loadTemplate('retrospective')">å›é¡¾æ€§ç ”ç©¶</span>
                    <span class="template-btn" onclick="loadTemplate('prospective')">å‰ç»æ€§ç ”ç©¶</span>
                    <span class="template-btn" onclick="loadTemplate('case-control')">ç—…ä¾‹å¯¹ç…§ç ”ç©¶</span>
                    <span class="template-btn" onclick="loadTemplate('cohort')">é˜Ÿåˆ—ç ”ç©¶</span>
                    <span class="template-btn" onclick="loadTemplate('meta')">Metaåˆ†æ</span>
                </div>
            </div>
            
            <div id="templateContent" class="output" style="min-height: 300px;">
                ç‚¹å‡»ä¸Šæ–¹æ¨¡æ¿æŒ‰é’®åŠ è½½ç›¸åº”çš„è®ºæ–‡ç»“æ„æ¨¡æ¿
            </div>
        </div>
        
        <!-- æ•°æ®åˆ†ætab -->
        <div id="analysis" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“ˆ æ•°æ®åˆ†æå·¥å…·</h2>
            
            <!-- æ•°æ®å¯¼å…¥åŒºåŸŸ -->
            <div class="section">
                <h3>ğŸ“ æ•°æ®å¯¼å…¥</h3>
                <div class="file-upload" onclick="document.getElementById('csvFileInput').click()">
                    <input type="file" id="csvFileInput" accept=".csv,.xlsx,.xls,.txt" onchange="importDataFile(event)">
                    <div style="color: #667eea; font-size: 18px; margin-bottom: 10px;">ğŸ“‚</div>
                    <div>ç‚¹å‡»é€‰æ‹©æ•°æ®æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        æ”¯æŒæ ¼å¼ï¼šCSV, Excel (.xlsx, .xls), æ–‡æœ¬æ–‡ä»¶
                    </div>
                </div>
                
                <div class="export-options">
                    <button onclick="loadSampleData()">ğŸ“‹ åŠ è½½ç¤ºä¾‹æ•°æ®</button>
                    <button onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
                    <button onclick="exportData()">ğŸ’¾ å¯¼å‡ºæ•°æ®</button>
                </div>
                
                <div id="importAlert"></div>
            </div>

            <!-- æ•°æ®é¢„è§ˆ -->
            <div class="section" id="dataPreviewSection" style="display: none;">
                <h3>ğŸ‘€ æ•°æ®é¢„è§ˆ</h3>
                <div class="data-summary" id="dataSummary"></div>
                <div class="data-preview" id="dataPreview"></div>
            </div>
            
            <!-- æ‰‹åŠ¨è¾“å…¥æ•°æ® -->
            <div class="section">
                <h3>âœï¸ æ‰‹åŠ¨è¾“å…¥æ•°æ®</h3>
                <div class="data-input">
                    <div>
                        <h4>ç»„1æ•°æ® (å®éªŒç»„)</h4>
                        <textarea id="group1Data" placeholder="è¾“å…¥æ•°å€¼ï¼Œç”¨é€—å·åˆ†éš”
ä¾‹å¦‚: 85.2, 87.1, 82.5, 89.3, 86.7"></textarea>
                        <input id="group1Label" placeholder="ç»„åˆ«æ ‡ç­¾" value="å®éªŒç»„">
                    </div>
                    <div>
                        <h4>ç»„2æ•°æ® (å¯¹ç…§ç»„)</h4>
                        <textarea id="group2Data" placeholder="è¾“å…¥æ•°å€¼ï¼Œç”¨é€—å·åˆ†éš”
ä¾‹å¦‚: 78.4, 76.8, 80.2, 75.9, 77.5"></textarea>
                        <input id="group2Label" placeholder="ç»„åˆ«æ ‡ç­¾" value="å¯¹ç…§ç»„">
                    </div>
                </div>
            </div>

            <!-- åˆ†ææ–¹æ³•é€‰æ‹© -->
            <div class="section">
                <h3>ğŸ”¬ åˆ†ææ–¹æ³•é€‰æ‹©</h3>
                <div class="analysis-options">
                    <div class="option-card" onclick="selectAnalysis('ttest')" id="ttest-card">
                        <h4>ğŸ“Š tæ£€éªŒ</h4>
                        <p>æ¯”è¾ƒä¸¤ç»„å‡å€¼å·®å¼‚</p>
                    </div>
                    <div class="option-card" onclick="selectAnalysis('correlation')" id="correlation-card">
                        <h4>ğŸ“ˆ ç›¸å…³æ€§åˆ†æ</h4>
                        <p>åˆ†æå˜é‡é—´å…³ç³»</p>
                    </div>
                    <div class="option-card" onclick="selectAnalysis('anova')" id="anova-card">
                        <h4>ğŸ“‹ æ–¹å·®åˆ†æ</h4>
                        <p>å¤šç»„å‡å€¼æ¯”è¾ƒ</p>
                    </div>
                    <div class="option-card" onclick="selectAnalysis('regression')" id="regression-card">
                        <h4>ğŸ“‰ å›å½’åˆ†æ</h4>
                        <p>é¢„æµ‹å’Œå…³ç³»å»ºæ¨¡</p>
                    </div>
                    <div class="option-card" onclick="selectAnalysis('nonparametric')" id="nonparametric-card">
                        <h4>ğŸ”„ éå‚æ•°æ£€éªŒ</h4>
                        <p>Mann-Whitney Uæ£€éªŒç­‰</p>
                    </div>
                    <div class="option-card" onclick="selectAnalysis('descriptive')" id="descriptive-card">
                        <h4>ğŸ“ æè¿°æ€§ç»Ÿè®¡</h4>
                        <p>åŸºæœ¬ç»Ÿè®¡é‡æè¿°</p>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button onclick="performAnalysis()">ğŸ” æ‰§è¡Œç»Ÿè®¡åˆ†æ</button>
                <button onclick="generateReport()">ğŸ“‹ ç”Ÿæˆåˆ†ææŠ¥å‘Š</button>
                <button onclick="exportAnalysis()">ğŸ“„ å¯¼å‡ºåˆ†æç»“æœ</button>
            </div>
            
            <div id="statsResults" class="stats-grid"></div>
            <div id="analysisReport" class="output"></div>
        </div>
        
        <!-- å›¾è¡¨åˆ¶ä½œtab -->
        <div id="charts" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“Š å›¾è¡¨åˆ¶ä½œå·¥å…·</h2>
            
            <div class="section">
                <h3>ğŸ“Š å›¾è¡¨ç±»å‹é€‰æ‹©</h3>
                <div>
                    <button onclick="createChart('bar')">ğŸ“Š æŸ±çŠ¶å›¾</button>
                    <button onclick="createChart('line')">ğŸ“ˆ æŠ˜çº¿å›¾</button>
                    <button onclick="createChart('pie')">ğŸ¥§ é¥¼å›¾</button>
                    <button onclick="createChart('scatter')">ğŸ”¹ æ•£ç‚¹å›¾</button>
                    <button onclick="createChart('roc')">ğŸ“‰ ROCæ›²çº¿</button>
                    <button onclick="createChart('box')">ğŸ“¦ ç®±çº¿å›¾</button>
                    <button onclick="createChart('histogram')">ğŸ“Š ç›´æ–¹å›¾</button>
                    <button onclick="createChart('heatmap')">ğŸ”¥ çƒ­åŠ›å›¾</button>
                </div>
            </div>
            
            <div class="section">
                <h3>âš™ï¸ å›¾è¡¨é…ç½®</h3>
                <div class="chart-controls">
                    <div class="control-group">
                        <label>å›¾è¡¨æ ‡é¢˜:</label>
                        <input id="chartTitle" placeholder="è¾“å…¥å›¾è¡¨æ ‡é¢˜" value="è¯Šæ–­å‡†ç¡®æ€§æ¯”è¾ƒ">
                    </div>
                    <div class="control-group">
                        <label>Xè½´æ ‡ç­¾:</label>
                        <input id="xAxisLabel" placeholder="Xè½´æ ‡ç­¾" value="ç»„åˆ«">
                    </div>
                    <div class="control-group">
                        <label>Yè½´æ ‡ç­¾:</label>
                        <input id="yAxisLabel" placeholder="Yè½´æ ‡ç­¾" value="å‡†ç¡®ç‡(%)">
                    </div>
                    <div class="control-group">
                        <label>å›¾è¡¨é¢œè‰²ä¸»é¢˜:</label>
                        <select id="colorTheme">
                            <option value="medical">åŒ»å­¦ä¸»é¢˜</option>
                            <option value="professional">ä¸“ä¸šä¸»é¢˜</option>
                            <option value="vibrant">é²œè‰³ä¸»é¢˜</option>
                            <option value="monochrome">å•è‰²ä¸»é¢˜</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>ğŸ“ æ•°æ®è¾“å…¥</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label>Xè½´æ•°æ®/æ ‡ç­¾:</label>
                        <textarea id="xLabels" placeholder="æ ‡ç­¾1,æ ‡ç­¾2,æ ‡ç­¾3" style="height: 80px;">ç»„åˆ«A,ç»„åˆ«B,ç»„åˆ«C</textarea>
                    </div>
                    <div>
                        <label>Yè½´æ•°æ®/æ•°å€¼:</label>
                        <textarea id="yData" placeholder="æ•°å€¼1,æ•°å€¼2,æ•°å€¼3" style="height: 80px;">85.2,78.4,91.1</textarea>
                    </div>
                </div>
                <div style="margin-top: 10px;">
                    <button onclick="useAnalysisDataForChart()">ğŸ“Š ä½¿ç”¨åˆ†ææ•°æ®</button>
                    <button onclick="generateRandomData()">ğŸ² ç”Ÿæˆéšæœºæ•°æ®</button>
                </div>
            </div>
            
            <div id="chartContainer" class="chart-container">
                <canvas id="myChart" width="400" height="200"></canvas>
            </div>
            
            <div class="export-options">
                <button onclick="downloadChart()">ğŸ’¾ ä¸‹è½½å›¾è¡¨</button>
                <button onclick="copyChartData()">ğŸ“‹ å¤åˆ¶å›¾è¡¨æ•°æ®</button>
                <button onclick="saveChartTemplate()">ğŸ”– ä¿å­˜ä¸ºæ¨¡æ¿</button>
                <button onclick="exportChartCode()">ğŸ’» å¯¼å‡ºå›¾è¡¨ä»£ç </button>
            </div>
        </div>
        
        <!-- å‚è€ƒæ–‡çŒ®tab -->
        <div id="references" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“š å‚è€ƒæ–‡çŒ®ç®¡ç†</h2>
            
            <div class="section">
                <h3>æ·»åŠ å‚è€ƒæ–‡çŒ®</h3>
                <div class="reference-input">
                    <input id="refTitle" placeholder="è®ºæ–‡æ ‡é¢˜">
                    <input id="refAuthor" placeholder="ä½œè€…">
                    <input id="refYear" placeholder="å¹´ä»½">
                </div>
                <div class="reference-input">
                    <input id="refJournal" placeholder="æœŸåˆŠåç§°">
                    <input id="refVolume" placeholder="å·å·">
                    <input id="refPages" placeholder="é¡µç ">
                </div>
                <button onclick="addReference()">â• æ·»åŠ æ–‡çŒ®</button>
            </div>
            
            <div class="section">
                <h3>æ–‡çŒ®æ ¼å¼</h3>
                <div>
                    <button onclick="formatReferences('apa')">APAæ ¼å¼</button>
                    <button onclick="formatReferences('vancouver')">Vancouveræ ¼å¼</button>
                    <button onclick="formatReferences('harvard')">Harvardæ ¼å¼</button>
                </div>
            </div>
            
            <div id="referencesList" class="output">
                å‚è€ƒæ–‡çŒ®å°†åœ¨æ­¤æ˜¾ç¤º...
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        let currentChart = null;
        let references = [];
        let currentProgress = 0;
        let importedData = null;
        let selectedAnalysis = 'ttest';
        let analysisResults = null;
        
        // Tabåˆ‡æ¢åŠŸèƒ½
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const navTabs = document.querySelectorAll('.nav-tab');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            navTabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // è¿›åº¦æ›´æ–°
        function updateProgress() {
            const fields = ['objective', 'methods', 'results', 'conclusion'];
            let completed = 0;
            
            fields.forEach(field => {
                if (document.getElementById(field).value.trim().length > 50) {
                    completed++;
                }
            });
            
            currentProgress = Math.round((completed / fields.length) * 100);
            document.getElementById('progressFill').style.width = currentProgress + '%';
            document.getElementById('progressText').textContent = currentProgress + '%';
        }
        
        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(message, type = 'success') {
            const alertDiv = document.getElementById('importAlert');
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 5000);
        }

        // æ•°æ®å¯¼å…¥åŠŸèƒ½
        function importDataFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                
                try {
                    if (file.name.endsWith('.csv') || file.name.endsWith('.txt')) {
                        importedData = parseCSV(text);
                    } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        // ç®€åŒ–çš„Excelå¤„ç†ï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦xlsx.jsåº“
                        showAlert('Excelæ–‡ä»¶å¯¼å…¥åŠŸèƒ½éœ€è¦é¢å¤–çš„åº“æ”¯æŒï¼Œè¯·è½¬æ¢ä¸ºCSVæ ¼å¼', 'warning');
                        return;
                    }
                    
                    if (importedData && importedData.length > 0) {
                        showDataPreview();
                        showAlert('æ•°æ®å¯¼å…¥æˆåŠŸï¼', 'success');
                    } else {
                        showAlert('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®æˆ–ä¸ºç©ºæ–‡ä»¶', 'error');
                    }
                } catch (error) {
                    showAlert('æ–‡ä»¶è§£æå¤±è´¥ï¼š' + error.message, 'error');
                }
            };
            
            reader.readAsText(file);
        }

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const row = {};
                headers.forEach((header, index) => {
                    const value = values[index];
                    // å°è¯•è½¬æ¢ä¸ºæ•°å­—
                    row[header] = isNaN(value) ? value : parseFloat(value);
                });
                data.push(row);
            }
            
            return { headers, data };
        }

        function showDataPreview() {
            if (!importedData) return;
            
            const section = document.getElementById('dataPreviewSection');
            const summary = document.getElementById('dataSummary');
            const preview = document.getElementById('dataPreview');
            
            section.style.display = 'block';
            
            // æ˜¾ç¤ºæ•°æ®æ‘˜è¦
            summary.innerHTML = `
                <strong>æ•°æ®æ‘˜è¦ï¼š</strong>
                è¡Œæ•°: ${importedData.data.length} | 
                åˆ—æ•°: ${importedData.headers.length} | 
                åˆ—å: ${importedData.headers.join(', ')}
            `;
            
            // æ˜¾ç¤ºæ•°æ®é¢„è§ˆè¡¨æ ¼
            let tableHTML = '<table class="data-table"><tr>';
            importedData.headers.forEach(header => {
                tableHTML += `<th>${header}</th>`;
            });
            tableHTML += '</tr>';
            
            // åªæ˜¾ç¤ºå‰10è¡Œæ•°æ®
            const previewRows = Math.min(10, importedData.data.length);
            for (let i = 0; i < previewRows; i++) {
                tableHTML += '<tr>';
                importedData.headers.forEach(header => {
                    const value = importedData.data[i][header];
                    tableHTML += `<td>${value !== undefined ? value : ''}</td>`;
                });
                tableHTML += '</tr>';
            }
            
            if (importedData.data.length > 10) {
                tableHTML += `<tr><td colspan="${importedData.headers.length}" style="text-align: center; color: #666;">... è¿˜æœ‰ ${importedData.data.length - 10} è¡Œæ•°æ®</td></tr>`;
            }
            
            tableHTML += '</table>';
            preview.innerHTML = tableHTML;
        }

        function loadSampleData() {
            const sampleCSV = `ç»„åˆ«,å‡†ç¡®ç‡,æ•æ„Ÿæ€§,ç‰¹å¼‚æ€§,AUC
å®éªŒç»„A,85.2,82.1,88.3,0.91
å®éªŒç»„B,78.4,75.8,81.0,0.85
å¯¹ç…§ç»„,74.1,71.2,77.0,0.82
ä¼ ç»Ÿæ–¹æ³•,69.8,66.5,73.1,0.78`;
            
            importedData = parseCSV(sampleCSV);
            showDataPreview();
            showAlert('ç¤ºä¾‹æ•°æ®å·²åŠ è½½', 'success');
        }

        function clearAllData() {
            importedData = null;
            document.getElementById('dataPreviewSection').style.display = 'none';
            document.getElementById('group1Data').value = '';
            document.getElementById('group2Data').value = '';
            showAlert('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'success');
        }

        function exportData() {
            if (!importedData) {
                showAlert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®', 'warning');
                return;
            }
            
            let csvContent = importedData.headers.join(',') + '\n';
            importedData.data.forEach(row => {
                const rowData = importedData.headers.map(header => row[header] || '');
                csvContent += rowData.join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'æ•°æ®å¯¼å‡º_' + new Date().toLocaleDateString() + '.csv';
            a.click();
        }

        // åˆ†ææ–¹æ³•é€‰æ‹©
        function selectAnalysis(method) {
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById(method + '-card').classList.add('selected');
            selectedAnalysis = method;
        }

        // ç”Ÿæˆæ¨¡æ¿å‡½æ•°
        function generateObjective() {
            const templates = [
                "æœ¬ç ”ç©¶æ—¨åœ¨è¯„ä¼°[å½±åƒæŠ€æœ¯/æ–¹æ³•]åœ¨[ç–¾ç—…/ç—…å˜]è¯Šæ–­ä¸­çš„ä¸´åºŠä»·å€¼ï¼Œæ¯”è¾ƒå…¶ä¸[å¯¹ç…§æ–¹æ³•]çš„è¯Šæ–­æ€§èƒ½ï¼Œä»¥æœŸä¸ºä¸´åºŠè¯Šç–—æä¾›å¾ªè¯åŒ»å­¦ä¾æ®ã€‚",
                "ç›®çš„ï¼šæ¢è®¨[å½±åƒå­¦è¡¨ç°/å¾è±¡]ä¸[ç–¾ç—…é¢„å/æ²»ç–—æ•ˆæœ]çš„ç›¸å…³æ€§ï¼Œå»ºç«‹åŸºäºå½±åƒç‰¹å¾çš„[é¢„æµ‹æ¨¡å‹/è¯„ä¼°ç³»ç»Ÿ]ã€‚",
                "æœ¬ç ”ç©¶é€šè¿‡å›é¡¾æ€§åˆ†æï¼Œè¯„ä»·[æ–°æŠ€æœ¯/æ–°æ–¹æ³•]åœ¨[ç‰¹å®šäººç¾¤]ä¸­çš„åº”ç”¨ä»·å€¼ï¼Œä¸ºä¼˜åŒ–å½±åƒè¯Šæ–­æµç¨‹æä¾›ç†è®ºä¾æ®ã€‚"
            ];
            
            const randomTemplate = templates[Math.floor(Math.random() * templates.length)];
            document.getElementById('objective').value = randomTemplate;
            updateProgress();
        }
        
        function generateMethods() {
            const template = `ç ”ç©¶è®¾è®¡ï¼šå›é¡¾æ€§/å‰ç»æ€§ç ”ç©¶
ç ”ç©¶å¯¹è±¡ï¼šé€‰æ‹©[æ—¶é—´èŒƒå›´]åœ¨æˆ‘é™¢å°±è¯Šçš„[ç–¾ç—…]æ‚£è€…[ä¾‹æ•°]ä¾‹
çº³å…¥æ ‡å‡†ï¼š(1)[æ ‡å‡†1]ï¼›(2)[æ ‡å‡†2]ï¼›(3)[æ ‡å‡†3]
æ’é™¤æ ‡å‡†ï¼š(1)[æ ‡å‡†1]ï¼›(2)[æ ‡å‡†2]ï¼›(3)[æ ‡å‡†3]
å½±åƒæ£€æŸ¥ï¼šä½¿ç”¨[è®¾å¤‡å‹å·]è¿›è¡Œæ£€æŸ¥ï¼Œæ‰«æå‚æ•°ï¼š[å…·ä½“å‚æ•°]
å›¾åƒåˆ†æï¼šç”±ä¸¤åå…·æœ‰[å¹´é™]å¹´ç»éªŒçš„å½±åƒç§‘åŒ»å¸ˆç‹¬ç«‹é˜…ç‰‡
ç»Ÿè®¡åˆ†æï¼šä½¿ç”¨SPSSè½¯ä»¶è¿›è¡Œç»Ÿè®¡åˆ†æï¼ŒP<0.05ä¸ºå·®å¼‚æœ‰ç»Ÿè®¡å­¦æ„ä¹‰`;
            
            document.getElementById('methods').value = template;
            updateProgress();
        }
        
        function generateResults() {
            const template = `åŸºçº¿ç‰¹å¾ï¼šå…±çº³å…¥æ‚£è€…[æ•°é‡]ä¾‹ï¼Œå…¶ä¸­ç”·æ€§[æ•°é‡]ä¾‹ï¼Œå¥³æ€§[æ•°é‡]ä¾‹ï¼Œå¹´é¾„[èŒƒå›´]å²
ä¸»è¦ç»“æœï¼š
1. [æ–¹æ³•1]çš„æ•æ„Ÿæ€§ä¸º[æ•°å€¼]%ï¼Œç‰¹å¼‚æ€§ä¸º[æ•°å€¼]%ï¼Œå‡†ç¡®æ€§ä¸º[æ•°å€¼]%
2. [æ–¹æ³•2]çš„æ•æ„Ÿæ€§ä¸º[æ•°å€¼]%ï¼Œç‰¹å¼‚æ€§ä¸º[æ•°å€¼]%ï¼Œå‡†ç¡®æ€§ä¸º[æ•°å€¼]%
3. ä¸¤ç§æ–¹æ³•çš„è¯Šæ–­æ€§èƒ½æ¯”è¾ƒï¼š[ç»Ÿè®¡ç»“æœ]
äºšç»„åˆ†æï¼š[å…·ä½“ç»“æœæè¿°]
å¹¶å‘ç—‡ï¼š[å¦‚æœ‰ç›¸å…³å†…å®¹]`;
            
            document.getElementById('results').value = template;
            updateProgress();
        }
        
        function generateConclusion() {
            const template = `æœ¬ç ”ç©¶ç»“æœè¡¨æ˜ï¼Œ[ä¸»è¦å‘ç°]ï¼Œæç¤º[ä¸´åºŠæ„ä¹‰]ã€‚[å½±åƒæ–¹æ³•]åœ¨[ç–¾ç—…]çš„è¯Šæ–­ä¸­å…·æœ‰[ä¼˜åŠ¿]ï¼Œå¯ä¸ºä¸´åºŠè¯Šç–—æä¾›é‡è¦å‚è€ƒã€‚

å±€é™æ€§ï¼šæœ¬ç ”ç©¶å­˜åœ¨ä»¥ä¸‹å±€é™æ€§ï¼š(1)[å±€é™æ€§1]ï¼›(2)[å±€é™æ€§2]ï¼›(3)[å±€é™æ€§3]

æœªæ¥ç ”ç©¶æ–¹å‘ï¼šå»ºè®®åç»­ç ”ç©¶å…³æ³¨[æ–¹å‘1]ã€[æ–¹å‘2]ç­‰æ–¹é¢ï¼Œä»¥è¿›ä¸€æ­¥ä¼˜åŒ–è¯Šæ–­ç­–ç•¥ã€‚`;
            
            document.getElementById('conclusion').value = template;
            updateProgress();
        }
        
        // å¯¼å‡ºè®ºæ–‡
        function exportPaper() {
            const objective = document.getElementById('objective').value;
            const methods = document.getElementById('methods').value;
            const results = document.getElementById('results').value;
            const conclusion = document.getElementById('conclusion').value;
            
            const paper = `åŒ»å­¦å½±åƒç ”ç©¶è®ºæ–‡

æ‘˜è¦

ç›®çš„
${objective}

æ–¹æ³•
${methods}

ç»“æœ
${results}

ç»“è®º
${conclusion}

å…³é”®è¯ï¼šåŒ»å­¦å½±åƒï¼Œ[å…³é”®è¯2]ï¼Œ[å…³é”®è¯3]ï¼Œ[å…³é”®è¯4]ï¼Œ[å…³é”®è¯5]
`;
            
            document.getElementById('paperOutput').style.display = 'block';
            document.getElementById('paperOutput').textContent = paper;
            
            // è‡ªåŠ¨ä¸‹è½½
            const blob = new Blob([paper], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'åŒ»å­¦å½±åƒè®ºæ–‡_' + new Date().toLocaleDateString() + '.txt';
            a.click();
        }
        
        // ä¿å­˜å’ŒåŠ è½½è‰ç¨¿
        function saveDraft() {
            const draft = {
                objective: document.getElementById('objective').value,
                methods: document.getElementById('methods').value,
                results: document.getElementById('results').value,
                conclusion: document.getElementById('conclusion').value,
                timestamp: new Date().toLocaleString()
            };
            
            const draftData = JSON.stringify(draft);
            const blob = new Blob([draftData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'è®ºæ–‡è‰ç¨¿_' + new Date().toLocaleDateString() + '.json';
            a.click();
            
            showAlert('è‰ç¨¿å·²ä¿å­˜å¹¶ä¸‹è½½ï¼');
        }
        
        function loadDraft() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const draft = JSON.parse(event.target.result);
                            document.getElementById('objective').value = draft.objective || '';
                            document.getElementById('methods').value = draft.methods || '';
                            document.getElementById('results').value = draft.results || '';
                            document.getElementById('conclusion').value = draft.conclusion || '';
                            updateProgress();
                            showAlert('è‰ç¨¿å·²æˆåŠŸåŠ è½½ï¼ä¿å­˜æ—¶é—´ï¼š' + draft.timestamp);
                        } catch (error) {
                            showAlert('è‰ç¨¿æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        // æ¨¡æ¿åŠ è½½
        function loadTemplate(type) {
            const templates = {
                'ct': {
                    title: 'CTå½±åƒåˆ†æç ”ç©¶æ¨¡æ¿',
                    content: `ç›®çš„ï¼šè¯„ä¼°CTå½±åƒåœ¨[ç–¾ç—…]è¯Šæ–­ä¸­çš„åº”ç”¨ä»·å€¼

æ–¹æ³•ï¼š
- ç ”ç©¶å¯¹è±¡ï¼š[æ—¶é—´èŒƒå›´]æ”¶æ²»çš„[ç–¾ç—…]æ‚£è€…
- CTæ‰«æï¼šä½¿ç”¨[CTæœºå‹]ï¼Œæ‰«æå‚æ•°ï¼šç®¡ç”µå‹[kV]ï¼Œç®¡ç”µæµ[mAs]ï¼Œå±‚åš[mm]
- å›¾åƒé‡å»ºï¼šé‡‡ç”¨[é‡å»ºç®—æ³•]è¿›è¡Œå›¾åƒé‡å»º
- å›¾åƒåˆ†æï¼šæµ‹é‡[æµ‹é‡æŒ‡æ ‡]ï¼Œè¯„ä¼°[è¯„ä¼°å†…å®¹]

ç»“æœï¼š
- CTå¾è±¡æè¿°ï¼š[å…·ä½“å¾è±¡]
- å®šé‡åˆ†æï¼š[æµ‹é‡ç»“æœ]
- è¯Šæ–­æ€§èƒ½ï¼šæ•æ„Ÿæ€§[%]ï¼Œç‰¹å¼‚æ€§[%]

ç»“è®ºï¼šCTæ£€æŸ¥åœ¨[ç–¾ç—…]è¯Šæ–­ä¸­å…·æœ‰é‡è¦ä»·å€¼`
                },
                'mri': {
                    title: 'MRIç ”ç©¶æ¨¡æ¿',
                    content: `ç›®çš„ï¼šæ¢è®¨MRIå¤šåºåˆ—æˆåƒåœ¨[ç–¾ç—…]ä¸­çš„è¯Šæ–­ä»·å€¼

æ–¹æ³•ï¼š
- MRIè®¾å¤‡ï¼š[ç£å…±æŒ¯æœºå‹] [ç£åœºå¼ºåº¦]T
- æ‰«æåºåˆ—ï¼šT1WIã€T2WIã€DWIã€[å…¶ä»–åºåˆ—]
- æ‰«æå‚æ•°ï¼šTR/TE [å…·ä½“å‚æ•°]
- å¯¹æ¯”å‰‚ï¼šä½¿ç”¨é’†å–·é…¸è‘¡èƒºï¼Œå‰‚é‡0.1mmol/kg

ç»“æœï¼š
- MRIä¿¡å·ç‰¹å¾ï¼šT1WI [ä¿¡å·]ï¼ŒT2WI [ä¿¡å·]
- DWIè¡¨ç°ï¼šADCå€¼ä¸º[æ•°å€¼]Ã—10â»Â³mmÂ²/s
- å¢å¼ºåè¡¨ç°ï¼š[å¢å¼ºæ¨¡å¼å’Œç¨‹åº¦]

ç»“è®ºï¼šMRIå¤šåºåˆ—æˆåƒæœ‰åŠ©äº[ç–¾ç—…]çš„è¯Šæ–­å’Œé‰´åˆ«è¯Šæ–­`
                },
                'retrospective': {
                    title: 'å›é¡¾æ€§ç ”ç©¶æ¨¡æ¿',
                    content: `ç ”ç©¶è®¾è®¡ï¼šå•ä¸­å¿ƒå›é¡¾æ€§ç ”ç©¶

æ–¹æ³•ï¼š
1. ç ”ç©¶å¯¹è±¡ï¼šå›é¡¾æ€§æ”¶é›†[æ—¶é—´èŒƒå›´]åœ¨æˆ‘é™¢[ç§‘å®¤]å°±è¯Šçš„æ‚£è€…
2. çº³å…¥æ ‡å‡†ï¼š(1)ä¸´åºŠèµ„æ–™å®Œæ•´ï¼›(2)å½±åƒå­¦æ£€æŸ¥å®Œæ•´ï¼›(3)æœ‰æ˜ç¡®è¯Šæ–­
3. æ’é™¤æ ‡å‡†ï¼š(1)å›¾åƒè´¨é‡å·®ï¼›(2)ä¸´åºŠèµ„æ–™ä¸å…¨ï¼›(3)éšè®¿èµ„æ–™ç¼ºå¤±
4. æ•°æ®æ”¶é›†ï¼šæ”¶é›†æ‚£è€…åŸºæœ¬ä¿¡æ¯ã€å®éªŒå®¤æ£€æŸ¥ã€å½±åƒå­¦è¡¨ç°ç­‰
5. ç»Ÿè®¡æ–¹æ³•ï¼šä½¿ç”¨SPSSè¿›è¡Œç»Ÿè®¡åˆ†æ

ä¼¦ç†å­¦ï¼šæœ¬ç ”ç©¶å·²é€šè¿‡åŒ»é™¢ä¼¦ç†å§”å‘˜ä¼šæ‰¹å‡†`
                }
            };
            
            const template = templates[type];
            if (template) {
                document.getElementById('templateContent').innerHTML = `
                    <h3>${template.title}</h3>
                    <pre style="white-space: pre-wrap; font-family: inherit;">${template.content}</pre>
                    <button onclick="applyTemplate('${type}')" style="margin-top: 15px;">åº”ç”¨æ­¤æ¨¡æ¿</button>
                `;
            }
        }
        
        function applyTemplate(type) {
            showAlert('æ¨¡æ¿å·²åº”ç”¨ï¼è¯·åˆ‡æ¢åˆ°"è®ºæ–‡ç»“æ„"æ ‡ç­¾é¡µæŸ¥çœ‹ã€‚');
        }
        
        // æ•°æ®åˆ†æåŠŸèƒ½
        function performAnalysis() {
            let group1, group2;
            
            // ä¼˜å…ˆä½¿ç”¨å¯¼å…¥çš„æ•°æ®
            if (importedData && importedData.data.length > 0) {
                // è‡ªåŠ¨æ£€æµ‹æ•°å€¼åˆ—
                const numericColumns = importedData.headers.filter(header => {
                    return importedData.data.some(row => typeof row[header] === 'number');
                });
                
                if (numericColumns.length < 1) {
                    showAlert('å¯¼å…¥çš„æ•°æ®ä¸­æ²¡æœ‰æ‰¾åˆ°æ•°å€¼åˆ—', 'error');
                    return;
                }
                
                // ä½¿ç”¨ç¬¬ä¸€ä¸ªæ•°å€¼åˆ—ä½œä¸ºåˆ†ææ•°æ®
                const dataColumn = numericColumns[0];
                group1 = importedData.data.map(row => row[dataColumn]).filter(val => typeof val === 'number');
                group2 = []; // å¯¹äºå¯¼å…¥æ•°æ®ï¼Œå¯èƒ½éœ€è¦æ ¹æ®åˆ†ç»„åˆ—æ¥åˆ†å‰²
                
                if (importedData.headers.includes('ç»„åˆ«') || importedData.headers.includes('group')) {
                    const groupColumn = importedData.headers.includes('ç»„åˆ«') ? 'ç»„åˆ«' : 'group';
                    const groups = {};
                    
                    importedData.data.forEach(row => {
                        const groupName = row[groupColumn];
                        const value = row[dataColumn];
                        if (typeof value === 'number') {
                            if (!groups[groupName]) groups[groupName] = [];
                            groups[groupName].push(value);
                        }
                    });
                    
                    const groupNames = Object.keys(groups);
                    if (groupNames.length >= 2) {
                        group1 = groups[groupNames[0]];
                        group2 = groups[groupNames[1]];
                        document.getElementById('group1Label').value = groupNames[0];
                        document.getElementById('group2Label').value = groupNames[1];
                    }
                }
            } else {
                // ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥çš„æ•°æ®
                group1 = document.getElementById('group1Data').value.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
                group2 = document.getElementById('group2Data').value.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
            }
            
            if (group1.length === 0) {
                showAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°æ®æˆ–å¯¼å…¥æ•°æ®æ–‡ä»¶', 'warning');
                return;
            }
            
            // æ ¹æ®é€‰æ‹©çš„åˆ†ææ–¹æ³•æ‰§è¡Œåˆ†æ
            switch (selectedAnalysis) {
                case 'ttest':
                    performTTestAnalysis(group1, group2);
                    break;
                case 'correlation':
                    performCorrelationAnalysis(group1, group2);
                    break;
                case 'anova':
                    performAnovaAnalysis();
                    break;
                case 'regression':
                    performRegressionAnalysis(group1, group2);
                    break;
                case 'nonparametric':
                    performNonParametricAnalysis(group1, group2);
                    break;
                case 'descriptive':
                    performDescriptiveAnalysis(group1, group2);
                    break;
                default:
                    performTTestAnalysis(group1, group2);
            }
        }

        function performTTestAnalysis(group1, group2) {
            if (group2.length === 0) {
                // å•æ ·æœ¬tæ£€éªŒ
                const stats1 = calculateStats(group1);
                const tTest = performOneSampleTTest(group1, 0); // ä¸0æ¯”è¾ƒ
                displaySingleGroupStats(stats1, tTest);
            } else {
                // ç‹¬ç«‹æ ·æœ¬tæ£€éªŒ
                const stats1 = calculateStats(group1);
                const stats2 = calculateStats(group2);
                const tTest = performTTest(group1, group2);
                displayStats(stats1, stats2, tTest);
            }
        }

        function performCorrelationAnalysis(group1, group2) {
            if (group2.length === 0 || group1.length !== group2.length) {
                showAlert('ç›¸å…³æ€§åˆ†æéœ€è¦ä¸¤ç»„ç­‰é•¿çš„æ•°æ®', 'warning');
                return;
            }
            
            const correlation = calculateCorrelation(group1, group2);
            displayCorrelationResults(correlation);
        }

        function performDescriptiveAnalysis(group1, group2) {
            const stats1 = calculateStats(group1);
            let stats2 = null;
            if (group2.length > 0) {
                stats2 = calculateStats(group2);
            }
            
            displayDescriptiveStats(stats1, stats2);
        }

        function performNonParametricAnalysis(group1, group2) {
            if (group2.length === 0) {
                showAlert('éå‚æ•°æ£€éªŒéœ€è¦ä¸¤ç»„æ•°æ®', 'warning');
                return;
            }
            
            const mannWhitney = performMannWhitneyTest(group1, group2);
            displayNonParametricResults(mannWhitney);
        }

        function performAnovaAnalysis() {
            if (!importedData) {
                showAlert('ANOVAåˆ†æéœ€è¦å¯¼å…¥å¤šç»„æ•°æ®', 'warning');
                return;
            }
            
            showAlert('ANOVAåˆ†æåŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­', 'warning');
        }

        function performRegressionAnalysis(group1, group2) {
            if (group2.length === 0 || group1.length !== group2.length) {
                showAlert('å›å½’åˆ†æéœ€è¦ä¸¤ç»„ç­‰é•¿çš„æ•°æ®', 'warning');
                return;
            }
            
            const regression = calculateLinearRegression(group1, group2);
            displayRegressionResults(regression);
        }
        
        function calculateStats(data) {
            const n = data.length;
            const mean = data.reduce((a, b) => a + b, 0) / n;
            const variance = data.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / (n - 1);
            const std = Math.sqrt(variance);
            const sorted = [...data].sort((a, b) => a - b);
            const median = n % 2 === 0 ? (sorted[n/2-1] + sorted[n/2]) / 2 : sorted[Math.floor(n/2)];
            const min = Math.min(...data);
            const max = Math.max(...data);
            const q1 = sorted[Math.floor(n * 0.25)];
            const q3 = sorted[Math.floor(n * 0.75)];
            
            return { n, mean, std, median, min, max, variance, q1, q3 };
        }
        
        function performTTest(group1, group2) {
            const n1 = group1.length;
            const n2 = group2.length;
            const mean1 = group1.reduce((a, b) => a + b, 0) / n1;
            const mean2 = group2.reduce((a, b) => a + b, 0) / n2;
            
            const var1 = group1.reduce((a, b) => a + Math.pow(b - mean1, 2), 0) / (n1 - 1);
            const var2 = group2.reduce((a, b) => a + Math.pow(b - mean2, 2), 0) / (n2 - 1);
            
            const pooledVar = ((n1 - 1) * var1 + (n2 - 1) * var2) / (n1 + n2 - 2);
            const standardError = Math.sqrt(pooledVar * (1/n1 + 1/n2));
            const tStatistic = (mean1 - mean2) / standardError;
            const df = n1 + n2 - 2;
            
            // ç®€åŒ–çš„på€¼ä¼°è®¡
            const abst = Math.abs(tStatistic);
            let pValue;
            if (abst > 3.5) pValue = "< 0.001";
            else if (abst > 2.8) pValue = "< 0.01";
            else if (abst > 2.0) pValue = "< 0.05";
            else pValue = "> 0.05";
            
            return { tStatistic, df, pValue, meanDiff: mean1 - mean2, standardError };
        }

        function calculateCorrelation(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);
            
            const r = (n * sumXY - sumX * sumY) / 
                     Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            
            return { r, r2: r * r, n };
        }

        function calculateLinearRegression(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            const r = calculateCorrelation(x, y).r;
            
            return { slope, intercept, r, r2: r * r };
        }

        function performMannWhitneyTest(group1, group2) {
            // ç®€åŒ–çš„Mann-Whitney Uæ£€éªŒ
            const combined = [...group1, ...group2];
            const ranks = combined.map((value, index) => ({ value, index, group: index < group1.length ? 1 : 2 }))
                                  .sort((a, b) => a.value - b.value)
                                  .map((item, rank) => ({ ...item, rank: rank + 1 }));
            
            const sumRank1 = ranks.filter(item => item.group === 1).reduce((sum, item) => sum + item.rank, 0);
            const u1 = sumRank1 - (group1.length * (group1.length + 1)) / 2;
            const u2 = group1.length * group2.length - u1;
            const u = Math.min(u1, u2);
            
            return { u, u1, u2, n1: group1.length, n2: group2.length };
        }
        
        function displayStats(stats1, stats2, tTest) {
            const label1 = document.getElementById('group1Label').value;
            const label2 = document.getElementById('group2Label').value;
            
            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-value">${stats1.n}</div>
                    <div class="stat-label">${label1} æ ·æœ¬é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.mean.toFixed(2)}</div>
                    <div class="stat-label">${label1} å‡å€¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.std.toFixed(2)}</div>
                    <div class="stat-label">${label1} æ ‡å‡†å·®</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats2.n}</div>
                    <div class="stat-label">${label2} æ ·æœ¬é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats2.mean.toFixed(2)}</div>
                    <div class="stat-label">${label2} å‡å€¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats2.std.toFixed(2)}</div>
                    <div class="stat-label">${label2} æ ‡å‡†å·®</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${tTest.tStatistic.toFixed(3)}</div>
                    <div class="stat-label">tç»Ÿè®¡é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${tTest.pValue}</div>
                    <div class="stat-label">På€¼</div>
                </div>
            `;
            
            document.getElementById('statsResults').innerHTML = statsHtml;
            analysisResults = { stats1, stats2, tTest, type: 'ttest' };
        }

        function displayDescriptiveStats(stats1, stats2) {
            const label1 = document.getElementById('group1Label').value || 'æ•°æ®ç»„';
            let statsHtml = `
                <div class="stat-card">
                    <div class="stat-value">${stats1.n}</div>
                    <div class="stat-label">${label1} æ ·æœ¬é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.mean.toFixed(2)}</div>
                    <div class="stat-label">${label1} å‡å€¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.median.toFixed(2)}</div>
                    <div class="stat-label">${label1} ä¸­ä½æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.std.toFixed(2)}</div>
                    <div class="stat-label">${label1} æ ‡å‡†å·®</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.min.toFixed(2)}</div>
                    <div class="stat-label">${label1} æœ€å°å€¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats1.max.toFixed(2)}</div>
                    <div class="stat-label">${label1} æœ€å¤§å€¼</div>
                </div>
            `;

            if (stats2) {
                const label2 = document.getElementById('group2Label').value || 'å¯¹ç…§ç»„';
                statsHtml += `
                    <div class="stat-card">
                        <div class="stat-value">${stats2.mean.toFixed(2)}</div>
                        <div class="stat-label">${label2} å‡å€¼</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats2.std.toFixed(2)}</div>
                        <div class="stat-label">${label2} æ ‡å‡†å·®</div>
                    </div>
                `;
            }
            
            document.getElementById('statsResults').innerHTML = statsHtml;
            analysisResults = { stats1, stats2, type: 'descriptive' };
        }
        
        function generateReport() {
            if (!analysisResults) {
                showAlert('è¯·å…ˆæ‰§è¡Œç»Ÿè®¡åˆ†æ', 'warning');
                return;
            }

            let report = '';
            
            switch (analysisResults.type) {
                case 'ttest':
                    report = generateTTestReport();
                    break;
                case 'descriptive':
                    report = generateDescriptiveReport();
                    break;
                case 'correlation':
                    report = generateCorrelationReport();
                    break;
                default:
                    report = 'åˆ†ææŠ¥å‘Šç”Ÿæˆä¸­...';
            }
            
            document.getElementById('analysisReport').textContent = report;
        }

        function generateTTestReport() {
            const { stats1, stats2, tTest } = analysisResults;
            const label1 = document.getElementById('group1Label').value;
            const label2 = document.getElementById('group2Label').value;
            
            return `ç»Ÿè®¡åˆ†ææŠ¥å‘Š - ç‹¬ç«‹æ ·æœ¬tæ£€éªŒ

åŸºæœ¬æè¿°æ€§ç»Ÿè®¡ï¼š
${label1}ç»„ï¼šæ ·æœ¬é‡ ${stats1.n} ä¾‹ï¼Œå¹³å‡å€¼ ${stats1.mean.toFixed(2)} Â± ${stats1.std.toFixed(2)}ï¼Œ
ä¸­ä½æ•° ${stats1.median.toFixed(2)}ï¼ŒèŒƒå›´ ${stats1.min.toFixed(2)} - ${stats1.max.toFixed(2)}

${label2}ç»„ï¼šæ ·æœ¬é‡ ${stats2.n} ä¾‹ï¼Œå¹³å‡å€¼ ${stats2.mean.toFixed(2)} Â± ${stats2.std.toFixed(2)}ï¼Œ
ä¸­ä½æ•° ${stats2.median.toFixed(2)}ï¼ŒèŒƒå›´ ${stats2.min.toFixed(2)} - ${stats2.max.toFixed(2)}

ç»„é—´æ¯”è¾ƒï¼š
é‡‡ç”¨ç‹¬ç«‹æ ·æœ¬tæ£€éªŒæ¯”è¾ƒä¸¤ç»„é—´å·®å¼‚ã€‚
t = ${tTest.tStatistic.toFixed(3)}, df = ${tTest.df}, P ${tTest.pValue}
å‡å€¼å·®å€¼ï¼š${tTest.meanDiff.toFixed(2)}
æ ‡å‡†è¯¯ï¼š${tTest.standardError.toFixed(3)}

ç»“è®ºï¼š
${tTest.pValue.includes('<') ? 'ä¸¤ç»„é—´å·®å¼‚å…·æœ‰ç»Ÿè®¡å­¦æ„ä¹‰' : 'ä¸¤ç»„é—´å·®å¼‚æ— ç»Ÿè®¡å­¦æ„ä¹‰'}ï¼ˆP ${tTest.pValue}ï¼‰ã€‚

æ³¨ï¼šæœ¬åˆ†æåŸºäºæ­£æ€åˆ†å¸ƒå‡è®¾ï¼Œå»ºè®®æ ¹æ®å®é™…æ•°æ®åˆ†å¸ƒé€‰æ‹©åˆé€‚çš„ç»Ÿè®¡æ–¹æ³•ã€‚`;
        }

        function generateDescriptiveReport() {
            const { stats1, stats2 } = analysisResults;
            const label1 = document.getElementById('group1Label').value || 'æ•°æ®ç»„';
            
            let report = `æè¿°æ€§ç»Ÿè®¡åˆ†ææŠ¥å‘Š

${label1}æ•°æ®æè¿°ï¼š
- æ ·æœ¬é‡ï¼š${stats1.n} ä¾‹
- å¹³å‡å€¼ï¼š${stats1.mean.toFixed(2)} Â± ${stats1.std.toFixed(2)}
- ä¸­ä½æ•°ï¼š${stats1.median.toFixed(2)}
- å››åˆ†ä½æ•°ï¼šQ1 = ${stats1.q1.toFixed(2)}, Q3 = ${stats1.q3.toFixed(2)}
- èŒƒå›´ï¼š${stats1.min.toFixed(2)} - ${stats1.max.toFixed(2)}
- æ–¹å·®ï¼š${stats1.variance.toFixed(2)}`;

            if (stats2) {
                const label2 = document.getElementById('group2Label').value || 'å¯¹ç…§ç»„';
                report += `

${label2}æ•°æ®æè¿°ï¼š
- æ ·æœ¬é‡ï¼š${stats2.n} ä¾‹
- å¹³å‡å€¼ï¼š${stats2.mean.toFixed(2)} Â± ${stats2.std.toFixed(2)}
- ä¸­ä½æ•°ï¼š${stats2.median.toFixed(2)}
- å››åˆ†ä½æ•°ï¼šQ1 = ${stats2.q1.toFixed(2)}, Q3 = ${stats2.q3.toFixed(2)}
- èŒƒå›´ï¼š${stats2.min.toFixed(2)} - ${stats2.max.toFixed(2)}`;
            }

            return report;
        }

        function exportAnalysis() {
            if (!analysisResults) {
                showAlert('æ²¡æœ‰å¯å¯¼å‡ºçš„åˆ†æç»“æœ', 'warning');
                return;
            }
            
            const report = document.getElementById('analysisReport').textContent;
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ç»Ÿè®¡åˆ†ææŠ¥å‘Š_' + new Date().toLocaleDateString() + '.txt';
            a.click();
        }
        
        // å›¾è¡¨åˆ¶ä½œåŠŸèƒ½
        function getColorTheme(theme) {
            const themes = {
                medical: [
                    'rgba(102, 126, 234, 0.8)',
                    'rgba(118, 75, 162, 0.8)',
                    'rgba(67, 163, 255, 0.8)',
                    'rgba(139, 195, 74, 0.8)',
                    'rgba(255, 193, 7, 0.8)',
                    'rgba(255, 87, 34, 0.8)'
                ],
                professional: [
                    'rgba(54, 162, 235, 0.8)',
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(255, 205, 86, 0.8)',
                    'rgba(75, 192, 192, 0.8)',
                    'rgba(153, 102, 255, 0.8)',
                    'rgba(255, 159, 64, 0.8)'
                ],
                vibrant: [
                    'rgba(255, 0, 128, 0.8)',
                    'rgba(0, 255, 128, 0.8)',
                    'rgba(128, 0, 255, 0.8)',
                    'rgba(255, 128, 0, 0.8)',
                    'rgba(0, 128, 255, 0.8)',
                    'rgba(128, 255, 0, 0.8)'
                ],
                monochrome: [
                    'rgba(52, 58, 64, 0.8)',
                    'rgba(108, 117, 125, 0.8)',
                    'rgba(173, 181, 189, 0.8)',
                    'rgba(222, 226, 230, 0.8)',
                    'rgba(248, 249, 250, 0.8)'
                ]
            };
            return themes[theme] || themes.medical;
        }

        function createChart(type) {
            const xLabels = document.getElementById('xLabels').value.split(',').map(x => x.trim());
            const yData = document.getElementById('yData').value.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
            const title = document.getElementById('chartTitle').value;
            const xAxisLabel = document.getElementById('xAxisLabel').value;
            const yAxisLabel = document.getElementById('yAxisLabel').value;
            const colorTheme = document.getElementById('colorTheme').value;
            
            if (currentChart) {
                currentChart.destroy();
            }
            
            const ctx = document.getElementById('myChart').getContext('2d');
            const colors = getColorTheme(colorTheme);
            
            let config = {
                type: type,
                data: {
                    labels: xLabels,
                    datasets: [{
                        label: yAxisLabel || 'æ•°å€¼',
                        data: yData,
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace('0.8', '1')),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: title,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: type !== 'pie'
                        }
                    },
                    scales: type === 'pie' ? {} : {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: yAxisLabel
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: xAxisLabel
                            }
                        }
                    }
                }
            };
            
            // ç‰¹æ®Šå›¾è¡¨ç±»å‹å¤„ç†
            if (type === 'roc') {
                config = createROCChart(colors[0]);
            } else if (type === 'box') {
                config = createBoxPlot(colors[0]);
            } else if (type === 'histogram') {
                config = createHistogram(yData, colors[0]);
            } else if (type === 'heatmap') {
                showAlert('çƒ­åŠ›å›¾åŠŸèƒ½éœ€è¦é¢å¤–çš„æ’ä»¶æ”¯æŒ', 'warning');
                return;
            }
            
            currentChart = new Chart(ctx, config);
        }

        function createROCChart(color) {
            return {
                type: 'line',
                data: {
                    labels: ['0.0', '0.1', '0.2', '0.3', '0.4', '0.5', '0.6', '0.7', '0.8', '0.9', '1.0'],
                    datasets: [{
                        label: 'ROCæ›²çº¿ (AUC=0.85)',
                        data: [0, 0.15, 0.35, 0.52, 0.68, 0.78, 0.85, 0.91, 0.95, 0.98, 1.0],
                        borderColor: color.replace('0.8', '1'),
                        backgroundColor: color.replace('0.8', '0.1'),
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'å‚è€ƒçº¿',
                        data: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0],
                        borderColor: 'rgba(128, 128, 128, 0.5)',
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ROCæ›²çº¿åˆ†æ',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: '1-ç‰¹å¼‚æ€§' },
                            min: 0,
                            max: 1
                        },
                        y: {
                            title: { display: true, text: 'æ•æ„Ÿæ€§' },
                            min: 0,
                            max: 1
                        }
                    }
                }
            };
        }

        function createBoxPlot(color) {
            // ç®€åŒ–çš„ç®±çº¿å›¾ï¼Œä½¿ç”¨æŠ˜çº¿å›¾æ¨¡æ‹Ÿ
            const data = document.getElementById('yData').value.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
            if (data.length === 0) return;
            
            const sorted = [...data].sort((a, b) => a - b);
            const q1 = sorted[Math.floor(sorted.length * 0.25)];
            const median = sorted[Math.floor(sorted.length * 0.5)];
            const q3 = sorted[Math.floor(sorted.length * 0.75)];
            const min = Math.min(...data);
            const max = Math.max(...data);
            
            return {
                type: 'bar',
                data: {
                    labels: ['æœ€å°å€¼', 'Q1', 'ä¸­ä½æ•°', 'Q3', 'æœ€å¤§å€¼'],
                    datasets: [{
                        label: 'æ•°æ®åˆ†å¸ƒ',
                        data: [min, q1, median, q3, max],
                        backgroundColor: color,
                        borderColor: color.replace('0.8', '1'),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'æ•°æ®åˆ†å¸ƒå›¾ï¼ˆäº”æ•°æ¦‚æ‹¬ï¼‰',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: { display: true, text: 'æ•°å€¼' }
                        }
                    }
                }
            };
        }

        function createHistogram(data, color) {
            if (data.length === 0) return;
            
            // ç®€å•çš„ç›´æ–¹å›¾åˆ†ç»„
            const min = Math.min(...data);
            const max = Math.max(...data);
            const bins = 8;
            const binWidth = (max - min) / bins;
            const binCounts = new Array(bins).fill(0);
            const binLabels = [];
            
            for (let i = 0; i < bins; i++) {
                const start = min + i * binWidth;
                const end = start + binWidth;
                binLabels.push(`${start.toFixed(1)}-${end.toFixed(1)}`);
                
                data.forEach(value => {
                    if (value >= start && (value < end || i === bins - 1)) {
                        binCounts[i]++;
                    }
                });
            }
            
            return {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'é¢‘æ•°',
                        data: binCounts,
                        backgroundColor: color,
                        borderColor: color.replace('0.8', '1'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'æ•°æ®åˆ†å¸ƒç›´æ–¹å›¾',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'é¢‘æ•°' }
                        },
                        x: {
                            title: { display: true, text: 'æ•°å€¼åŒºé—´' }
                        }
                    }
                }
            };
        }

        function useAnalysisDataForChart() {
            if (!analysisResults) {
                showAlert('è¯·å…ˆæ‰§è¡Œæ•°æ®åˆ†æ', 'warning');
                return;
            }
            
            const { stats1, stats2 } = analysisResults;
            const label1 = document.getElementById('group1Label').value || 'ç»„1';
            const label2 = document.getElementById('group2Label').value || 'ç»„2';
            
            if (stats2) {
                document.getElementById('xLabels').value = `${label1},${label2}`;
                document.getElementById('yData').value = `${stats1.mean.toFixed(2)},${stats2.mean.toFixed(2)}`;
            } else {
                document.getElementById('xLabels').value = label1;
                document.getElementById('yData').value = stats1.mean.toFixed(2);
            }
            
            showAlert('åˆ†ææ•°æ®å·²åº”ç”¨åˆ°å›¾è¡¨', 'success');
        }

        function generateRandomData() {
            const count = 5;
            const labels = [];
            const values = [];
            
            for (let i = 1; i <= count; i++) {
                labels.push(`ç»„åˆ«${i}`);
                values.push((Math.random() * 50 + 50).toFixed(1));
            }
            
            document.getElementById('xLabels').value = labels.join(',');
            document.getElementById('yData').value = values.join(',');
            showAlert('éšæœºæ•°æ®å·²ç”Ÿæˆ', 'success');
        }
        
        function downloadChart() {
            if (!currentChart) {
                showAlert('è¯·å…ˆåˆ›å»ºå›¾è¡¨', 'warning');
                return;
            }
            
            const url = currentChart.toBase64Image();
            const a = document.createElement('a');
            a.href = url;
            a.download = 'å›¾è¡¨_' + new Date().toLocaleDateString() + '.png';
            a.click();
        }
        
        function copyChartData() {
            const xLabels = document.getElementById('xLabels').value;
            const yData = document.getElementById('yData').value;
            const title = document.getElementById('chartTitle').value;
            
            const chartData = `å›¾è¡¨æ ‡é¢˜: ${title}
Xè½´æ ‡ç­¾: ${xLabels}
Yè½´æ•°æ®: ${yData}`;
            
            navigator.clipboard.writeText(chartData).then(() => {
                showAlert('å›¾è¡¨æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            });
        }

        function saveChartTemplate() {
            const template = {
                title: document.getElementById('chartTitle').value,
                xAxis: document.getElementById('xAxisLabel').value,
                yAxis: document.getElementById('yAxisLabel').value,
                xLabels: document.getElementById('xLabels').value,
                yData: document.getElementById('yData').value,
                colorTheme: document.getElementById('colorTheme').value,
                timestamp: new Date().toLocaleString()
            };
            
            const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'å›¾è¡¨æ¨¡æ¿_' + new Date().toLocaleDateString() + '.json';
            a.click();
            
            showAlert('å›¾è¡¨æ¨¡æ¿å·²ä¿å­˜');
        }

        function exportChartCode() {
            if (!currentChart) {
                showAlert('è¯·å…ˆåˆ›å»ºå›¾è¡¨', 'warning');
                return;
            }
            
            const code = `// Chart.js å›¾è¡¨ä»£ç 
const ctx = document.getElementById('myChart').getContext('2d');
const chart = new Chart(ctx, ${JSON.stringify(currentChart.config, null, 2)});`;
            
            const blob = new Blob([code], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'å›¾è¡¨ä»£ç _' + new Date().toLocaleDateString() + '.js';
            a.click();
        }
        
        // å‚è€ƒæ–‡çŒ®ç®¡ç†
        function addReference() {
            const title = document.getElementById('refTitle').value;
            const author = document.getElementById('refAuthor').value;
            const year = document.getElementById('refYear').value;
            const journal = document.getElementById('refJournal').value;
            const volume = document.getElementById('refVolume').value;
            const pages = document.getElementById('refPages').value;
            
            if (!title || !author || !year) {
                showAlert('è¯·è‡³å°‘å¡«å†™æ ‡é¢˜ã€ä½œè€…å’Œå¹´ä»½', 'warning');
                return;
            }
            
            const reference = {
                id: references.length + 1,
                title,
                author,
                year,
                journal,
                volume,
                pages
            };
            
            references.push(reference);
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('refTitle').value = '';
            document.getElementById('refAuthor').value = '';
            document.getElementById('refYear').value = '';
            document.getElementById('refJournal').value = '';
            document.getElementById('refVolume').value = '';
            document.getElementById('refPages').value = '';
            
            formatReferences('vancouver'); // é»˜è®¤æ˜¾ç¤ºVancouveræ ¼å¼
            showAlert('å‚è€ƒæ–‡çŒ®å·²æ·»åŠ ', 'success');
        }
        
        function formatReferences(style) {
            if (references.length === 0) {
                document.getElementById('referencesList').innerHTML = 'æš‚æ— å‚è€ƒæ–‡çŒ®ï¼Œè¯·å…ˆæ·»åŠ æ–‡çŒ®';
                return;
            }
            
            let formattedRefs = '';
            
            references.forEach((ref, index) => {
                let formatted = '';
                
                switch (style) {
                    case 'apa':
                        formatted = `${ref.author} (${ref.year}). ${ref.title}. ${ref.journal || 'æœŸåˆŠå'}${ref.volume ? `, ${ref.volume}` : ''}${ref.pages ? `, ${ref.pages}` : ''}.`;
                        break;
                    case 'vancouver':
                        formatted = `${index + 1}. ${ref.author}. ${ref.title}. ${ref.journal || 'æœŸåˆŠå'}. ${ref.year}${ref.volume ? `;${ref.volume}` : ''}${ref.pages ? `:${ref.pages}` : ''}.`;
                        break;
                    case 'harvard':
                        formatted = `${ref.author}, ${ref.year}. '${ref.title}', ${ref.journal || 'æœŸåˆŠå'}${ref.volume ? `, vol. ${ref.volume}` : ''}${ref.pages ? `, pp. ${ref.pages}` : ''}.`;
                        break;
                }
                
                formattedRefs += formatted + '\n\n';
            });
            
            document.getElementById('referencesList').innerHTML = `<strong>${style.toUpperCase()}æ ¼å¼ï¼š</strong><br><br><pre style="white-space: pre-wrap; font-family: inherit;">${formattedRefs}</pre>`;
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            updateProgress();
            // åˆå§‹åŒ–å›¾è¡¨
            createChart('bar');
            // é»˜è®¤é€‰æ‹©tæ£€éªŒ
            selectAnalysis('ttest');
        };
    </script>
</body>
</html>
